/*!
 * jQuery Upload File Plugin
 * version: 3.1.2
 * @requires jQuery v1.5 or later & form plugin
 * Copyright (c) 2013 Ravishanker Kusuma
 * http://hayageek.com/
 */(function(a){a.fn.ajaxForm==void 0;var b={};b.fileapi=a("<input type='file'/>").get(0).files!==void 0,b.formdata=window.FormData!==void 0,a.fn.uploadFile=function(o){var d=a.extend({url:"",method:"POST",enctype:"multipart/form-data",formData:null,returnType:null,allowedTypes:"*",fileName:"file",formData:{},dynamicFormData:function(){return{}},maxFileSize:-1,maxFileCount:-1,multiple:!0,dragDrop:!0,autoSubmit:!0,showCancel:!0,showAbort:!0,showDone:!0,showDelete:!1,showError:!0,showStatusAfterSuccess:!0,showStatusAfterError:!0,showFileCounter:!0,fileCounterStyle:"). ",showProgress:!1,onSelect:function(a){return!0},onSubmit:function(a,b){},onSuccess:function(a,b,c){},onError:function(a,b,c){},deleteCallback:!1,afterUploadAll:!1,uploadButtonClass:"upload",dragDropStr:"",abortStr:"Abort",cancelStr:"Cancel",deletelStr:"Delete",doneStr:"Done",multiDragErrorStr:"Multiple File Drag &amp; Drop is not allowed.",extErrorStr:"",sizeErrorStr:"",uploadErrorStr:"Upload is not allowed",maxFileCountErrorStr:""},o),h,c,f,g;this.fileCounter=1,this.selectedFiles=0,this.fCounter=0,this.sCounter=0,this.tCounter=0,h="upload-"+(new Date).getTime(),this.formGroup=h,this.hide(),this.errorLog=a("<div></div>"),this.after(this.errorLog),this.responses=[],b.formdata||(d.dragDrop=!1),b.formdata||(d.multiple=!1),c=this,f=a("<div>"+a(this).html()+"</div>"),a(f).addClass(d.uploadButtonClass),function e(){if(a.fn.ajaxForm){if(d.dragDrop){var b=a('<div class="ajax-upload-dragdrop" style="vertical-align:top;"></div>');a(c).before(b),a(b).append(f),a(b).prepend(a(d.dragDropStr)),p(c,d,b)}else a(c).before(f);j(c,h,d,f)}else window.setTimeout(e,10)}(),this.startUpload=function(){a("."+this.formGroup).each(function(b,c){a(this).is("form")&&a(this).submit()})},this.stopUpload=function(){a(".upload-red").each(function(b,d){a(this).hasClass(c.formGroup)&&a(this).click()})},this.getResponses=function(){return this.responses},g=!1;function q(){d.afterUploadAll&&!g&&(g=!0,function a(){c.sCounter!=0&&c.sCounter+c.fCounter==c.tCounter?(d.afterUploadAll(c),g=!1):window.setTimeout(a,100)}())}function p(d,b,c){c.on("dragenter",function(b){b.stopPropagation(),b.preventDefault(),a(this).css("border","2px dashed #ddd")}),c.on("dragover",function(a){a.stopPropagation(),a.preventDefault()}),c.on("drop",function(e){a(this).css("border","2px dashed #ddd"),e.preventDefault(),d.errorLog.html("");var c=e.originalEvent.dataTransfer.files;if(!b.multiple&&c.length>1){b.showError&&a("<div class='um-error-block'>"+b.multiDragErrorStr+"</div>").appendTo(d.errorLog);return}if(b.onSelect(c)==!1)return;m(b,d,c)}),a(document).on("dragenter",function(a){a.stopPropagation(),a.preventDefault()}),a(document).on("dragover",function(a){a.stopPropagation(),a.preventDefault(),c.css("border","2px dashed #ddd")}),a(document).on("drop",function(a){a.stopPropagation(),a.preventDefault(),c.css("border","2px dashed #ddd")})}function r(c){var a="",b=c/1024,d;return parseInt(b)>1024?(d=b/1024,a=d.toFixed(2)+" MB"):a=b.toFixed(2)+" KB",a}function l(d){var b=[],g,f,c,e;jQuery.type(d)=="string"?b=d.split("&"):b=a.param(d).split("&"),g=b.length,f=[];for(c=0;c<g;c++)b[c]=b[c].replace(/\+/g," "),e=b[c].split("="),f.push([decodeURIComponent(e[0]),decodeURIComponent(e[1])]);return f}function m(b,c,e){for(var d=0,o,h,s,j,g,f,r,p,m,q;d<e.length;d++){if(!n(c,b,e[d].name)){b.showError&&a("<div class='um-error-block'>"+b.extErrorStr+"</div>").appendTo(c.errorLog);continue}if(b.maxFileSize!=-1&&e[d].size>b.maxFileSize){b.showError&&a("<div class='um-error-block'>"+b.sizeErrorStr+"</div>").appendTo(c.errorLog);continue}if(b.maxFileCount!=-1&&c.selectedFiles>=b.maxFileCount){b.showError&&a("<div class='um-error-block'>"+b.maxFileCountErrorStr+"</div>").appendTo(c.errorLog);continue}if(c.selectedFiles++,o=b,h=new FormData,s=b.fileName.replace("[]",""),h.append(s,e[d]),j=b.formData,j){g=l(j);for(f=0;f<g.length;f++)g[f]&&h.append(g[f][0],g[f][1])}o.fileData=h,r=new i(c,b),p="",b.showFileCounter?p=c.fileCounter+b.fileCounterStyle+e[d].name:p=e[d].name,m=a("<form style='display:block; position:absolute;left: 150px;' class='"+c.formGroup+"' method='"+b.method+"' action='"+b.url+"' enctype='"+b.enctype+"'></form>"),m.appendTo("body"),q=[],q.push(e[d].name),k(m,o,r,q,c),c.fileCounter++}}function n(e,a,b){var c=a.allowedTypes.toLowerCase().split(","),d=b.split(".").pop().toLowerCase();return!(a.allowedTypes!="*"&&jQuery.inArray(d,c)<0)}function e(b,d){if(b.showFileCounter){var c=a(".upload-filename").length;d.fileCounter=c+1,a(".upload-filename").each(function(f,g){var d=a(this).html().split(b.fileCounterStyle),h=parseInt(d[0])-1,e=c+b.fileCounterStyle+d[1];a(this).html(e),c--})}}function j(d,h,c,g){var l="ajax-upload-id-"+(new Date).getTime(),f=a("<form method='"+c.method+"' action='"+c.url+"' enctype='"+c.enctype+"'></form>"),o="<input type='file' id='"+l+"' name='"+c.fileName+"'/>",p,q,r;c.multiple&&(c.fileName.indexOf("[]")!=c.fileName.length-2&&(c.fileName+="[]"),o="<input type='file' id='"+l+"' name='"+c.fileName+"' multiple/>"),p=a(o).appendTo(f),p.change(function(){var u,o,p,r,t,q,l,s;if(d.errorLog.html(""),u=c.allowedTypes.toLowerCase().split(","),o=[],this.files){{for(l=0;l<this.files.length;l++)o.push(this.files[l].name);if(c.onSelect(this.files)==!1)return}}else{if(p=a(this).val(),r=[],o.push(p),!n(d,c,p)){c.showError&&a("<div class='um-error-block'>"+c.extErrorStr+"</div>").appendTo(d.errorLog);return}if(r.push({name:p,size:"NA"}),c.onSelect(r)==!1)return}if(e(c,d),g.unbind("click"),f.hide(),j(d,h,c,g),f.addClass(h),b.fileapi&&b.formdata)f.removeClass(h),t=this.files,m(c,d,t);else{q="";for(l=0;l<o.length;l++)c.showFileCounter?q+=d.fileCounter+c.fileCounterStyle+o[l]+"<br>":q+=o[l]+"<br>",d.fileCounter++;if(c.maxFileCount!=-1&&d.selectedFiles+o.length>c.maxFileCount){c.showError&&a("<div class='um-error-block'>"+c.maxFileCountErrorStr+"</div>").appendTo(d.errorLog);return}d.selectedFiles+=o.length,s=new i(d,c),s.filename.html(q),k(f,c,s,o,d)}}),f.css({margin:0,padding:0}),q=a(g).width()+10,q==10&&(q=120),r=g.height()+10,r==10&&(r=35),g.css({position:"relative",overflow:"hidden",cursor:"default"}),p.css({position:"absolute",cursor:"pointer",top:"0px",width:'100%',height:'34px',left:"0px","z-index":"100",opacity:"0.0",filter:"alpha(opacity=0)","-ms-filter":"alpha(opacity=0)","-khtml-opacity":"0.0","-moz-opacity":"0.0"}),f.appendTo(g)}function i(c,b){return this.statusbar=a("<div class='upload-statusbar'></div>"),this.progressDiv=a("<div class='upload-progress'>").appendTo(this.statusbar).hide(),this.progressbar=a("<div class='upload-bar "+c.formGroup+"'></div>").appendTo(this.progressDiv),this.abort=a("<div class='upload-red "+c.formGroup+"'>"+b.abortStr+"</div>").appendTo(this.statusbar).hide(),this.cancel=a("<div class='upload-red'>"+b.cancelStr+"</div>").appendTo(this.statusbar).hide(),this.done=a("<div class='upload-green'>"+b.doneStr+"</div>").appendTo(this.statusbar).hide(),this.del=a("<div class='upload-red'>"+b.deletelStr+"</div>").appendTo(this.statusbar).hide(),c.errorLog.after(this.statusbar),this}function k(g,c,a,f,d){var i=null,h={cache:!1,contentType:!1,processData:!1,forceSync:!1,data:c.formData,formData:c.fileData,dataType:c.returnType,beforeSubmit:function(j,k,i){var h,b,e;if(c.onSubmit.call(this,f)!=!1){if(h=c.dynamicFormData(),h)if(b=l(h),b)for(e=0;e<b.length;e++)b[e]&&(c.fileData!=void 0?i.formData.append(b[e][0],b[e][1]):i.data[b[e][0]]=b[e][1]);return d.tCounter+=f.length,q(),!0}return a.statusbar.append("<div class='um-error-block'>"+c.uploadErrorStr+"</div>"),a.cancel.show(),g.remove(),a.cancel.click(function(){a.statusbar.remove()}),!1},beforeSend:function(e,g){a.progressDiv.show(),a.cancel.hide(),a.done.hide(),c.showAbort&&(a.abort.show(),a.abort.click(function(){e.abort(),d.selectedFiles-=f.length})),b.formdata?a.progressbar.width("1%"):a.progressbar.width("5%")},uploadProgress:function(e,f,g,b){b>98&&(b=98);var d=b+"%";b>1&&a.progressbar.width(d),c.showProgress&&(a.progressbar.html(d),a.progressbar.css("text-align","center"))},success:function(b,i,h){d.responses.push(b),a.progressbar.width("100%"),c.showProgress&&(a.progressbar.html("100%"),a.progressbar.css("text-align","center")),a.abort.hide(),c.onSuccess.call(this,f,b,h),c.showStatusAfterSuccess?(c.showDone?(a.done.show(),a.done.click(function(){a.statusbar.hide("slow"),a.statusbar.remove()})):a.done.hide(),c.showDelete?(a.del.show(),a.del.click(function(){a.statusbar.hide().remove(),c.deleteCallback&&c.deleteCallback.call(this,b,a),d.selectedFiles-=f.length,e(c,d)})):a.del.hide()):(a.statusbar.hide("slow"),a.statusbar.remove()),g.remove(),d.sCounter+=f.length},error:function(h,i,b){a.abort.hide(),h.statusText=="abort"?(a.statusbar.hide("slow").remove(),e(c,d)):(c.onError.call(this,f,i,b),c.showStatusAfterError?(a.progressDiv.hide(),a.statusbar.append("<span class='um-error-block'>ERROR: "+b+"</span>")):(a.statusbar.hide(),a.statusbar.remove()),d.selectedFiles-=f.length),g.remove(),d.fCounter+=f.length}};c.autoSubmit?g.ajaxSubmit(h):(c.showCancel&&(a.cancel.show(),a.cancel.click(function(){g.remove(),a.statusbar.remove(),d.selectedFiles-=f.length,e(c,d)})),g.ajaxForm(h))}return this}})(jQuery)
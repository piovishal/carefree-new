(function(a){'use strict';var b=a.epoAPI.util.getStorage('localStorage'),d=window.confirm,c=function(b,c){return!!(this.elements=a(b),this.last=[],this.current=[],this.enableEvents=!0,this.backup=[],this.options=a.extend({},a.fn.tcTabs.defaults,c),this.elements.length>0)&&(this.init(),this)};c.prototype={constructor:c,set:function(b){this.options=a.extend({},this.options,b),this.init()},addHeaderEvents:function(e,f,h,g,n,k,l,m,i){var j='',c=this;g.off('closetab.tmtabs').on('closetab.tmtabs',function(){var b=a(this),d=e.find(b.data('tab'));b.removeClass('closed open').addClass('closed'),b.find('.tm-arrow').removeClass(c.options.classdown+' '+c.options.classup).addClass(c.options.classdown),c.options.useclasstohide?d.addClass('tm-hide').removeClass('tm-show'):d.hide(),d.removeClass('tm-animated '+c.options.animationclass),a(window).trigger('tc-closetab.tmtabs',{header:b,tab:d})}),g.off('opentab.tmtabs').on('opentab.tmtabs',function(){var b=a(this),d=e.find(b.data('tab'));b.removeClass('closed open').addClass('open'),b.find('.tm-arrow').removeClass(c.options.classdown+' '+c.options.classup).addClass(c.options.classup),c.options.useclasstohide?d.removeClass('tm-hide').addClass('tm-show'):d.show(),d.removeClass('tm-animated '+c.options.animationclass).addClass('tm-animated '+c.options.animationclass),c.current[f]=b.data('tab'),a(window).trigger('tc-opentab.tmtabs',{header:b,tab:c.current[f],table:d}),c.scrollIntoView(e,b,i)}),(c.options.showonhover===!0||typeof c.options.showonhover=='function')&&(j=' mouseover'),g.off('keydown.tmtabs').on('keydown.tmtabs',function(d){var e=a(this),b;d.keyCode===13&&e.trigger('click.tmtabs'),d.keyCode===40&&(b=e.closest('.tm-box').next().find('.'+c.options.header)),d.keyCode===38&&(b=e.closest('.tm-box').prev().find('.'+c.options.header)),b&&b.length&&(e.trigger('blur'),b.trigger(' focus').trigger('click'),d.preventDefault())}),g.off('click.tmtabs').on('click.tmtabs'+j,function(g){var d=a(this);if(g.preventDefault(),g.type==='mouseover'&&typeof c.options.showonhover=='function'&&!c.options.showonhover.call())return;if(c.current[f]===d.data('tab')){a(window).trigger('tc-isopentab.tmtabs',{header:d,tab:c.current[f],table:e.find(c.current[f])});return}c.last[f]&&a(c.last[f]).trigger('closetab.tmtabs'),d.trigger('opentab.tmtabs'),c.last[f]=d,b&&b.setItem('tmadmintab-'+h,d.attr(c.options.dataopenattribute)),a(window).trigger('tc-tmtabs-clicked',{tc:h,options:c.options,header:d,tab:c.current[f],table:e.find(c.current[f])})}),this.options.deletebutton?(g.append(this.options.deletebuttonhtml),g.find('.'+this.options.deleteheader).off('click.tmtabs').on('click.tmtabs',function(j){var f=a(this),b=f.closest('.tm-box'),g=b.find('.'+c.options.header),h=e.find('.'+g.attr(c.options.dataattribute));if(j.stopPropagation(),e.find('.'+c.options.headers+' '+'.'+c.options.header).length<2)return;if(c.options.deleteconfirm)if(!d(window.TMEPOGLOBALADMINJS.i18n_builder_delete))return;typeof c.options.beforedeletetab=='function'&&c.options.beforedeletetab.call(e,f,h),h.remove(),g.is('.open')&&(b.next().find('.'+c.options.header).is('.closed')?b.next().find('.'+c.options.header).trigger('click.tmtabs'):b.prev().find('.'+c.options.header).is('.closed')&&b.prev().find('.'+c.options.header).trigger('click.tmtabs')),b.remove(),c.checkSize(n,k,l,m,i,!0),typeof c.options.afterdeletetab=='function'&&c.options.afterdeletetab.call(e)})):g.find('.'+this.options.deleteheader).remove(),this.options.editbutton?(g.append(c.options.editbuttonhtml),g.find('.'+c.options.editheader).off('click.tmtabs').on('click.tmtabs',function(f){var b,d;c.enableEvents&&typeof c.options.oneditbutton=='function'&&(f.stopPropagation(),b=a(this),d=e.find('.'+b.closest('.tm-box').find('.'+c.options.header).attr(c.options.dataattribute)),c.options.oneditbutton.call(e,b,d))})):g.find('.'+this.options.editheader).remove()},initHeader:function(b,d,e,k,g,h,i,j){var f=0,l=d.attr('class'),c;b=a(b),c='.'+b.attr(this.options.dataattribute),b.data('tab',c),this.options.useclasstohide?d.find(c).addClass('tm-hide').removeClass('tm-show'):d.find(c).hide(),d.find(c).data('state','closed'),!f&&b.is('.open')?(b.removeClass('closed open').addClass('open').data('state','open'),b.find('.tm-arrow').removeClass(this.options.classdown+' '+this.options.classup).addClass(this.options.classup),this.options.useclasstohide?d.find(c).removeClass('tm-hide').addClass('tm-show'):d.find(c).show(),d.find(c).data('state','open'),f=1,this.current[e]=c,this.last[e]=b):b.removeClass('closed open').addClass('closed').data('state','closed'),this.addHeaderEvents(d,e,l,b,k,g,h,i,j)},checkSize:function(j,b,e,f,g,i){var h=[],k=b.parents().addBack().not(':visible'),d,c;k.each(function(){var b=a(this),e=this.style.display,g=b.css('display'),f=this.style.visibility,i=b.css('visibility'),d=!1,c={styleDisplay:e,cssDisplay:g,styleVisibility:f,cssVisibility:i,display:null,visibility:null,element:b};e==='none'&&(this.style.display='',c.display=!0,b.css('display')==='none'&&(this.style.display='block'),d=!0),f==='hidden'&&(this.style.visibility='',c.visibility=!0,b.css('visibility')==='hidden'&&(this.style.visibility='visible'),d=!0),d&&h.push(c)}),d=Math.round(b.outerWidth()),b.is('.has-scroll-arrows')&&(b.removeClass('.has-scroll-arrows'),d=Math.round(j.outerWidth())),i&&(c=b.find('.'+this.options.header+'.open'),c.length&&c.removeClass('open'),g.scrollWidth=b[0].scrollWidth,c.length&&c.addClass('open')),g.scrollWidth>d?(f.addClass('scroll-arrow-show'),e.addClass('scroll-arrow-show'),b.addClass('has-scroll-arrows'),g.scrollWidth-d===b.scrollLeft()?f.addClass('scroll-arrow-disabled scroll-arrow-right-disabled'):f.removeClass('scroll-arrow-disabled scroll-arrow-right-disabled'),b.scrollLeft()===0?e.addClass('scroll-arrow-disabled scroll-arrow-left-disabled'):e.removeClass('scroll-arrow-disabled scroll-arrow-left-disabled')):(f.removeClass('scroll-arrow-show'),e.removeClass('scroll-arrow-show'),b[0].scrollLeft=0,b.removeClass('has-scroll-arrows')),h.forEach(function(a){a.display&&(a.element[0].style.display=a.styleDisplay),a.visibility&&(a.element[0].style.visibility=a.styleVisibility)})},scrollIntoView:function(f,a,c){var d=c.scrollPos,b=f.find('.'+this.options.headers),e=b.width();b.is('.has-scroll-arrows')&&a&&typeof a!='undefined'&&a.position()&&typeof a.position()!='undefined'&&(a.position().left<0?(c.scrollPos=Math.max(d+a.position().left+1,0),b.animate({scrollLeft:c.scrollPos+1+'px'},this.options.scrollDuration)):a.position().left+a.outerWidth()>e&&(c.scrollPos=Math.min(d+(a.position().left+a.outerWidth()-e),b[0].scrollWidth-b.outerWidth()),b.animate({scrollLeft:c.scrollPos-1+'px'},this.options.scrollDuration)))},initElement:function(d,m,f,o){var c=this,s=d.attr('class'),r=d.find('.'+this.options.headers+' '+'.'+this.options.header),l=0,p='',k={},e,g,i,j,h,q,n;if(r.length===0)return;e=d.find('.'+this.options.headers),e.wrap('<div class="'+this.options.headersWrap+'"></div>'),g=d.find('.'+this.options.headersWrap),this.options.scroll&&(g.html('<div class="tc-scroll-left-arrow"></div>'+g.html()+'<div class="tc-scroll-right-arrow"></div>'),r=d.find('.'+this.options.headers+' '+'.'+this.options.header),e=d.find('.'+this.options.headers),i=d.find('.tc-scroll-left-arrow'),h=d.find('.tc-scroll-right-arrow'),typeof a.fn.mousewheel=='function'&&e.mousewheel(function(a,b){h.css('display')!=='none'&&(this.scrollLeft-=b*30,f.scrollPos=this.scrollLeft,a.preventDefault())}),e.animate({scrollLeft:f.scrollPos+'px'},0),this.checkSize(g,e,i,h,f,!0),a(window).off('resize.tmtabs'+o).on('resize.tmtabs'+o,function(){c.checkSize(g,e,i,h,f,!0)}),d.off('refresh.tmtabs'+o).on('refresh.tmtabs'+o,function(){c.checkSize(g,e,i,h,f,!0)}),a(function(){c.checkSize(g,e,i,h,f,!0)}),h.off('mousedown.tmtabs mouseup.tmtabs mouseleave.tmtabs mouseover.tmtabs mouseout.tmtabs').on('mousedown.tmtabs',function(b){var a=function(){var a=e.scrollLeft();f.scrollPos=Math.min(a+c.options.scrollDistance,f.scrollWidth-e.outerWidth()),e.animate({scrollLeft:f.scrollPos+'px'},c.options.scrollDuration,function(){c.checkSize(g,e,i,h,f)})};b.stopPropagation(),a(),n=setInterval(function(){a()},c.options.scrollDuration)}).on('mouseup.tmtabs mouseleave.tmtabs',function(){clearInterval(n)}).on('mouseover.tmtabs',function(){a(this).addClass('scroll-arrow-over scroll-arrow-right-over')}).on('mouseout.tmtabs',function(){a(this).removeClass('scroll-arrow-over scroll-arrow-right-over')}),i.off('mousedown.tmtabs mouseup.tmtabs mouseleave.tmtabs mouseover.tmtabs mouseout.tmtabs').on('mousedown.tmtabs',function(b){var a=function(){var a=e.scrollLeft();f.scrollPos=Math.max(a-c.options.scrollDistance,0),e.animate({scrollLeft:f.scrollPos+'px'},c.options.scrollDuration,function(){c.checkSize(g,e,i,h,f)})};b.stopPropagation(),a(),n=setInterval(function(){a()},c.options.scrollDuration)}).on('mouseup.tmtabs mouseleave.tmtabs',function(){clearInterval(n)}).on('mouseover.tmtabs',function(){a(this).addClass('scroll-arrow-over scroll-arrow-left-over')}).on('mouseout.tmtabs',function(){a(this).removeClass('scroll-arrow-over scroll-arrow-left-over')})),window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(c,a,b){k[a]=b}),this.last[m]=!1,this.current[m]='',d.data('tm-has-tmtabs',1),r.each(function(b,a){c.initHeader(a,d,m,g,e,i,h,f)}),this.options.sortabletabs&&d.find('.'+this.options.headers+':not(.section_elements '+'.'+this.options.headers+',.tm-settings-wrap '+'.'+this.options.headers+',.builder-element-wrap '+'.'+this.options.headers+')').sortable({cursor:'move',items:'.tm-box:not(.tm-add-box)',start:function(f,b){var e;e=d.find('.'+b.item.closest('.tm-box').find('.'+c.options.header).attr(c.options.dataattribute)),l=b.item.index(),p=b.item.find('.'+c.options.header).attr(c.options.dataopenattribute),q=a.tmEPOAdmin.find_index(!0,e.find('.bitem').first()),typeof c.options.beforemovetab=='function'&&c.options.beforemovetab.call(this,l,e,q),c.enableEvents=!1},stop:function(h,g){var f=d.find('.'+g.item.closest('.tm-box').find('.'+c.options.header).attr(c.options.dataattribute)),b=d.find('.'+c.options.slide+'.'+p),a=d.find('.'+c.options.headers+' '+'.'+c.options.header+'['+c.options.dataopenattribute+"='"+p+"']").parent().index(),e=d.find('.'+c.options.slide).eq(a);a>l?e.after(b):a<l&&e.before(b),typeof c.options.aftermovetab=='function'&&c.options.aftermovetab.call(this,a,l,f,q),c.enableEvents=!0},cancel:'.tm-add-box',forcePlaceholderSize:!0,revert:200,placeholder:'tm-box pl',tolerance:'pointer'}),this.options.addbutton?(g.append(this.options.addbuttonhtml),d.addClass('has-add-button').find('.'+this.options.addheader).off('click.tmtabs').on('click.tmtabs',function(p){var o=d.find('.'+c.options.headers+' '+'.'+c.options.header),k=o.last(),l=k.attr(c.options.dataattribute),n=d.find('.'+l),b=k.tcClone().off('closetab.tmtabs opentab.tmtabs click.tmtabs'),a=n.tcClone().empty(),j=c.options.slide+o.length;p.preventDefault(),b.html('<span class="tab-text">'+(d.find('.'+c.options.headers+' '+'.'+c.options.header).length+1)+'</span>').removeClass('closed open').addClass('closed').data('tab','.'+j).data('state','closed').attr(c.options.dataattribute,j),a.removeClass(l).addClass(j),c.options.useclasstohide?a.addClass('tm-hide').removeClass('.tm-show'):a.hide(),a.removeClass('tm-animated '+c.options.animationclass),k.closest('.tm-box').after(b),b.wrap('<div class="tm-box"></div>'),c.addHeaderEvents(d,m,s,b,g,e,i,h,f),n.after(a),c.options.scroll&&e.animate({scrollLeft:b.width()+'px'},c.options.scrollDuration,function(){c.checkSize(g,e,i,h,f,!0)}),typeof c.options.afteraddtab=='function'&&c.options.afteraddtab.call(this,b,a)})):g.find('.'+this.options.addheader).remove(),this.options.selectedtab==='auto'?(b&&(j=b.getItem('tmadmintab-'+s)),k.selected_tab!==void 0&&(j=k.selected_tab),k.menu!==void 0&&(j=k.menu),(j===void 0||j===null)&&(j=d.find('.'+this.options.header).eq(0).attr(this.options.dataopenattribute)),d.find('.'+this.options.header+'['+this.options.dataopenattribute+'="'+j+'"]').is(':visible')?d.find('.'+this.options.header+'['+this.options.dataopenattribute+'="'+j+'"]').trigger('click.tmtabs'):d.find('.'+this.options.header).eq(0).trigger('click.tmtabs')):this.options.selectedtab!==!1&&(j=parseInt(this.options.selectedtab,10),d.find('.'+this.options.header+':eq('+j+')').trigger('click.tmtabs'))},init:function(){var b=this;this.elements.each(function(d){var c=a(this),e={},g=c.html(),f;b.backup[d]?c.html(b.backup[d]):b.backup[d]=g,e.scrollPos=0,e.scrollWidth=0,f=c.css('display'),c.show(),b.initElement(c,d,e,a.epoAPI.math.uniqueid('')),c.css('display',f)})}},a.fn.tcTabs=function(d){var f=a(this),b=f.data('tctabs'),i=a.makeArray(arguments),g,h,e;return i.splice(0,1),typeof d=='object'?g=d:g={},b||(b=new c(this,g),f.data('tctabs',b)),typeof d=='string'&&(e=b[d].apply(b,i)),e===void 0?h=f:h=e,h},a.fn.tcTabs.defaults={headers:'tm-tab-headers',headersWrap:'tc-tab-headers-wrap',header:'tab-header',slide:'tc-tab-slide',classdown:'tcfa-angle-down',classup:'tcfa-angle-up',animationclass:'appear',dataattribute:'data-id',dataopenattribute:'data-id',selectedtab:'auto',showonhover:!1,useclasstohide:!0,sortabletabs:!0,addbutton:!1,addheader:'tm-add-tab',addbuttonhtml:'<div class="tm-add-tab"><span class="tmicon tcfa tcfa-plus"></span></div>',afteraddtab:null,beforemovetab:null,aftermovetab:null,deletebutton:!1,deletebuttonhtml:'<div class="tm-del-tab"><span class="tcfa tcfa-times"></span></div>',deleteheader:'tm-del-tab',deleteconfirm:!1,beforedeletetab:null,afterdeletetab:null,editbutton:!1,editbuttonhtml:'<span class="tm-edit-tab"><span class="tcfa tcfa-edit"></span></span>',editheader:'tm-edit-tab',oneditbutton:null,scroll:!0,scrollDistance:300,scrollDuration:300},a.fn.tcTabs.Constructor=c,a.fn.tmtabs=a.fn.tcTabs})(window.jQuery)
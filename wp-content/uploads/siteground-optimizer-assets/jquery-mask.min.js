(function(a,b,c){'use strict';typeof define=='function'&&define.amd?define(['jquery'],a):typeof exports=='object'&&typeof Meteor=='undefined'?window.module.exports=a(window.require('jquery')):a(b||c)})(function(a){'use strict';var e=window.JSON,c=function(c,e,f){var d=this,b={invalid:[],getCaret:function(){var d,e=0,g,f,a;try{return g=c.get(0),f=document.selection,a=g.selectionStart,f&&navigator.appVersion.indexOf('MSIE 10')===-1?(d=f.createRange(),d.moveStart('character',-b.val().length),e=d.text.length):(a||a==='0')&&(e=a),e}catch(a){window.console.log(a)}},setCaret:function(b){var a,d;try{c.is(':focus')&&(d=c.get(0),d.setSelectionRange?d.setSelectionRange(b,b):(a=d.createTextRange(),a.collapse(!0),a.moveEnd('character',b),a.moveStart('character',b),a.select()))}catch(a){window.console.log(a)}},events:function(){c.on('keydown.mask',function(a){c.data('mask-keycode',a.keyCode||a.which),c.data('mask-previus-value',c.val()),c.data('mask-previus-caret-pos',b.getCaret()),b.maskDigitPosMapOld=b.maskDigitPosMap}).on(a.jMaskGlobals.useInput?'input.mask':'keyup.mask',b.behaviour).on('paste.mask drop.mask',function(){setTimeout(function(){c.keydown().keyup()},100)}).on('change.mask',function(){c.data('changed',!0)}).on('blur.mask',function(){g!==b.val()&&!c.data('changed')&&c.trigger('change'),c.data('changed',!1)}).on('blur.mask',function(){g=b.val()}).on('focus.mask',function(b){f.selectOnFocus===!0&&a(b.target).select()}).on('focusout.mask',function(){f.clearIfNotMatch&&!h.test(b.val())&&b.val('')})},getRegexMask:function(){var f=[],c,g,j,i,b,h,a;for(a=0;a<e.length;a+=1)c=d.translation[e.charAt(a)],c?(g=c.pattern.toString().replace(/.{1}$|^.{1}/g,''),j=c.optional,i=c.recursive,i?(f.push(e.charAt(a)),b={digit:e.charAt(a),pattern:g}):f.push(!j&&!i?g:g+'?')):f.push(e.charAt(a).replace(/[-\/\\^$*+?.()|[\]{}]/g,'\\$&'));return h=f.join(''),b&&(h=h.replace(new RegExp('('+b.digit+'(.*'+b.digit+')?)'),'($1)?').replace(new RegExp(b.digit,'g'),b.pattern)),new RegExp(h)},destroyEvents:function(){c.off(['input','keydown','keyup','paste','drop','blur','focusout',''].join('.mask '))},val:function(d){var e=c.is('input'),a=e?'val':'text',b;return arguments.length>0?(c[a]()!==d&&c[a](d),b=c):b=c[a](),b},calculateCaretPosition:function(l){var m=b.getMasked(),a=b.getCaret(),h=0,i=0,f=0,g=0,d=0,j,e,k,n;if(l!==m){e=c.data('mask-previus-caret-pos')||0,k=m.length,j=l.length;for(d=a;d<k;d+=1){if(!b.maskDigitPosMap[d])break;i=i+1}for(d=a-1;d>=0;d-=1){if(!b.maskDigitPosMap[d])break;h=h+1}for(d=a-1;d>=0;d-=1)b.maskDigitPosMap[d]&&(f=f+1);for(d=e-1;d>=0;d-=1)b.maskDigitPosMapOld[d]&&(g=g+1);a>j?a=k*10:e>=a&&e!==j?b.maskDigitPosMapOld[a]||(n=a,a-=g-f,a-=h,b.maskDigitPosMap[a]&&(a=n)):a>e&&(a+=f-g,a+=i)}return a},behaviour:function(e){var i=c.data('mask-keycode'),f,g,h;if(e=e||window.event,b.invalid=[],a.inArray(i,d.byPassKeys)===-1)return f=b.getMasked(),h=b.getCaret(),g=c.data('mask-previus-value')||'',setTimeout(function(){b.setCaret(b.calculateCaretPosition(g))},a.jMaskGlobals.keyStrokeCompensation),b.val(f),b.setCaret(h),b.callbacks(e)},getMasked:function(y,x){var m=[],w=x===void 0?b.val():x+'',a=0,q=e.length,c=0,p=w.length,g=1,o='push',l=-1,k=0,u=[],j,s,t,n,i,h,v,r;for(f.reverse?(o='unshift',g=-1,j=0,a=q-1,c=p-1,s=function(){return a>-1&&c>-1}):(j=q-1,s=function(){return a<q&&c<p});s();)n=e.charAt(a),i=w.charAt(c),h=d.translation[n],h?(i.match(h.pattern)?(m[o](i),h.recursive&&(l===-1?l=a:a===j&&a!==l&&(a=l-g),j===l&&(a-=g)),a+=g):i===t?(k=k-1,t=void 0):h.optional?(a+=g,c-=g):h.fallback?(m[o](h.fallback),a+=g,c-=g):b.invalid.push({p:c,v:i,e:h.pattern}),c+=g):(y||m[o](n),i===n?(u.push(c),c+=g):(t=n,u.push(c+k),k=k+1),a+=g);return v=e.charAt(j),q===p+1&&!d.translation[v]&&m.push(v),r=m.join(''),b.mapMaskdigitPositions(r,u,p),r},mapMaskdigitPositions:function(d,c,e){var g=f.reverse?d.length-e:0,a;b.maskDigitPosMap={};for(a=0;a<c.length;a+=1)b.maskDigitPosMap[c[a]+g]=1},callbacks:function(i){var a=b.val(),j=a!==g,h=[a,i,c,f],d=function(a,b,c){typeof f[a]=='function'&&b&&f[a].apply(this,c)};d('onChange',j===!0,h),d('onKeyPress',j===!0,h),d('onComplete',a.length===e.length,h),d('onInvalid',b.invalid.length>0,[a,i,c,b.invalid,f])}},g,h;c=a(c),g=b.val(),e=typeof e=='function'?e(b.val(),void 0,c,f):e,d.mask=e,d.options=f,d.remove=function(){var a=b.getCaret();return d.options.placeholder&&c.removeAttr('placeholder'),c.data('mask-maxlength')&&c.removeAttr('maxlength'),b.destroyEvents(),b.val(d.getCleanVal()),b.setCaret(a),c},d.getCleanVal=function(){return b.getMasked(!0)},d.getMaskedVal=function(a){return b.getMasked(!1,a)},d.init=function(i){var g,j,l,k;if(i=i||!1,f=f||{},d.clearIfNotMatch=a.jMaskGlobals.clearIfNotMatch,d.byPassKeys=a.jMaskGlobals.byPassKeys,d.translation=a.extend({},a.jMaskGlobals.translation,f.translation),d=a.extend(!0,{},d,f),h=b.getRegexMask(),i)b.events(),b.val(b.getMasked());else{f.placeholder&&c.attr('placeholder',f.placeholder),c.data('mask')&&c.attr('autocomplete','off');for(g=0,k=!0;g<e.length;g+=1)if(j=d.translation[e.charAt(g)],j&&j.recursive){k=!1;break}k&&c.attr('maxlength',e.length).data('mask-maxlength',!0),b.destroyEvents(),b.events(),l=b.getCaret(),b.val(b.getMasked()),b.setCaret(l)}},d.init(!c.is('input'))},d=function(c,b,d){var f=a(c).data('mask'),g=e.stringify,h=a(c).val()||a(c).text();d=d||{};try{return typeof b=='function'&&(b=b(h)),typeof f!='object'||g(f.options)!==g(d)||f.mask!==b}catch(a){window.console.log(a)}},f=function(){var b=a(this),e={},f='data-mask-',g=b.attr('data-mask');if(b.attr(f+'reverse')&&(e.reverse=!0),b.attr(f+'clearifnotmatch')&&(e.clearIfNotMatch=!0),b.attr(f+'selectonfocus')==='true'&&(e.selectOnFocus=!0),d(b,g,e))return b.data('mask',new c(this,g,e))},g=function(a){var b=document.createElement('div'),c;return a='on'+a,c=a in b,c||(b.setAttribute(a,'return;'),c=typeof b[a]=='function'),b=null,c},b;a.maskWatchers={},a.fn.mask=function(i,b){var e=this.selector,g=a.jMaskGlobals,j=g.watchInterval,h,f;return b=b||{},h=b.watchInputs||g.watchInputs,f=function(){if(d(this,i,b))return a(this).data('mask',new c(this,i,b))},a(this).each(f),e&&e!==''&&h&&(clearInterval(a.maskWatchers[e]),a.maskWatchers[e]=setInterval(function(){a(document).find(e).each(f)},j)),this},a.fn.masked=function(a){return this.data('mask').getMaskedVal(a)},a.fn.unmask=function(){return clearInterval(a.maskWatchers[this.selector]),delete a.maskWatchers[this.selector],this.each(function(){var b=a(this).data('mask');b&&b.remove().removeData('mask')})},a.fn.cleanVal=function(){return this.data('mask').getCleanVal()},a.applyDataMask=function(b){var c;b=b||a.jMaskGlobals.maskElements,c=b instanceof a?b:a(b),c.filter(a.jMaskGlobals.dataMaskAttr).each(f)},b={maskElements:'input,td,span,div',dataMaskAttr:'*[data-mask]',dataMask:!0,watchInterval:300,watchInputs:!0,keyStrokeCompensation:10,useInput:!/Chrome\/[2-4][0-9]|SamsungBrowser/.test(window.navigator.userAgent)&&g('input'),watchDataMask:!1,byPassKeys:[9,16,17,18,36,37,38,39,40,91],translation:{0:{pattern:/\d/},9:{pattern:/\d/,optional:!0},'#':{pattern:/\d/,recursive:!0},A:{pattern:/[a-zA-Z0-9]/},S:{pattern:/[a-zA-Z]/}}},a.jMaskGlobals=a.jMaskGlobals||{},b=a.jMaskGlobals=a.extend(!0,{},b,a.jMaskGlobals),b.dataMask&&a.applyDataMask(),setInterval(function(){a.jMaskGlobals.watchDataMask&&a.applyDataMask()},b.watchInterval)},window.jQuery,window.Zepto)
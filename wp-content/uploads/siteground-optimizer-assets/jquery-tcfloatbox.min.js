(function(a){'use strict';var b=function(b,c){return!!(this.element=a(b),this.settings=a.extend({},a.fn.tcFloatBox.defaults,c),this.settings.type='<'+this.settings.type+'>',this.top=0,this.left=0,this.ticking=!1,this.element.length===1)&&(this.init(),this)};b.prototype={constructor:b,destroy:function(){var b=this.settings;return this.instance!==void 0&&(a.fn.tcFloatBox.instances.splice(this.instance,1),delete this.instance,b.hideelements&&a('embed, object, select').css({visibility:'visible'}),b._ovl&&(b._ovl.off(),b._ovl.remove(),delete b._ovl),a(b.floatboxID).remove(),this.element.removeData('tcfloatbox'),a(window).off('scroll.tcfloatbox'+this.instance),a(window).off('resize.tcfloatbox'+this.instance)),this},hide:function(){var b=this.settings;b.hideelements&&a('embed, object, select').css({visibility:'visible'}),b.showoverlay===!0&&b._ovl&&b._ovl.hide(),a(b.floatboxID).addClass('tc-closing').removeClass(b.animateIn).addClass(b.animateOut),a(b.floatboxID).animate({opacity:0},b.closefadeouttime,function(){a(b.floatboxID).hide(),a(b.floatboxID).removeClass('tc-closing').addClass('tc-closed')}),a(window).off('scroll.tcfloatbox'+this.instance),a(window).off('resize.tcfloatbox'+this.instance)},requestTick:function(){var a=this.settings;this.ticking||(a.refresh?setTimeout(this.requestAnimationFrame.bind(this),a.refresh):requestAnimationFrame(this.update),this.ticking=!0)},requestAnimationFrame:function(){requestAnimationFrame(this.update.bind(this))},update:function(){this.render(),this.ticking=!1},doit:function(){this.requestTick()},render:function(){var b=this.settings,f=a.epoAPI.dom.size(),c,d,e;b.refresh==='fixed'?c={top:0,left:0}:c=a.epoAPI.dom.scroll(),d=parseInt(c.top+(f.visibleHeight-a(b.floatboxID).height())/2,10),e=parseInt(c.left+(f.visibleWidth-a(b.floatboxID).width())/2,10),d=parseInt((d-this.top)/b.fps,10),e=parseInt((e-this.left)/b.fps,10),this.top+=d,this.left+=e,a(b.floatboxID).css({top:this.top+'px',left:this.left+'px',opacity:1})},show:function(){var b=this.settings,c,d;this.element.length===1&&(this.instance===void 0&&this.init(),b.hideelements&&a('embed, object, select').css({visibility:'hidden'}),d=a.epoAPI.dom.size(),b.showoverlay===!0&&(b._ovl?b._ovl.show():(b._ovl=a('<div class="fl-overlay"></div>').css({zIndex:parseInt(b.zIndex,10)-1,opacity:b.overlayopacity}),b._ovl.appendTo('body'),b.ismodal||(b.cancelEvent||b.unique?b._ovl.on('click',this.applyCancelEvent.bind(this)):b._ovl.on('click',b.cancelfunc.bind(this))))),b.showfunc&&b.showfunc.call(),a(b.floatboxID).removeClass('tc-closing').addClass(b.animationBaseClass+' '+b.animateIn),b.refresh==='fixed'?(b.top!==!1?c=b.top:(c=parseInt((d.visibleHeight-a(b.floatboxID).height())/2,10),c=c+'px'),a(b.floatboxID).css({position:'fixed',top:c}),b.left!==!1&&a(b.floatboxID).css({left:b.left})):this.render())},applyCancelEvent:function(){var a=this.settings;a.cancelEvent===!0?this.destroy():typeof a.cancelEvent=='function'&&a.cancelEvent.call(this,this)},applyCancelEventFromKey:function(a){a.which===27&&this.applyCancelEvent()},applyUpdateEvent:function(){var a=this.settings;typeof a.updateEvent=='function'&&a.updateEvent.call(this,this)},applyUpdateEventFromKey:function(a){a.which===13&&this.applyUpdateEvent()},init:function(){var b=this.settings,f=0,e,d,c;this.element.length===1&&(a.fn.tcFloatBox.instances.length>0&&(b.zIndex=parseInt(a.fn.tcFloatBox.instances[a.fn.tcFloatBox.instances.length-1].zIndex,10)+100),this.instance=a.fn.tcFloatBox.instances.length,a.fn.tcFloatBox.instances.push(b),b.id=b.id+this.instance,b.floatboxID='#'+a.epoAPI.dom.id(b.id),this.hide(),d=a.epoAPI.dom.size(),e=a.epoAPI.dom.scroll(),a(b.type).attr('id',b.id).addClass(b.classname).html(b.data).appendTo(this.element),a(b.floatboxID).css({width:b.width,height:b.height}),c=parseInt(e.left+(d.visibleWidth-a(b.floatboxID).width())/2,10),a(b.floatboxID).css({top:f+'px',left:c+'px','z-index':b.zIndex}),this.top=f,this.left=c,this.cancelfunc=b.cancelfunc,b.cancelEvent&&b.cancelClass&&(a(b.floatboxID).find(b.cancelClass).on('click',this.applyCancelEvent.bind(this)),b.isconfirm&&a(document).off('keyup.escape-'+b.floatboxID).on('keyup.escape-'+b.floatboxID,this.applyCancelEventFromKey.bind(this))),b.updateEvent&&b.updateClass&&(a(b.floatboxID).find(b.updateClass).on('click',this.applyUpdateEvent.bind(this)),b.isconfirm&&a(document).off('keyup.enter-'+b.floatboxID).on('keyup.enter-'+b.floatboxID,this.applyUpdateEventFromKey.bind(this))),this.show(),b.refresh!=='fixed'&&a(window).on('scroll.tcfloatbox'+this.instance,this.doit.bind(this)),a(window).on('resize.tcfloatbox'+this.instance,this.doit.bind(this)))}},a.fn.tcFloatBox=function(d){var f=a(this),c=f.data('tcfloatbox'),e,g,h;return typeof d=='object'?g=d:g={},c||(c=new b(this,g),f.data('tcfloatbox',c)),typeof d=='string'&&(e=c[d].apply(c,[])),e===void 0?h=f:h=e,h},a.fn.tcFloatBox.defaults={id:'flasho',classname:'flasho',type:'div',data:'',width:'500px',height:'auto',closefadeouttime:1e3,animationBaseClass:'tm-animated',animateIn:'fadein',animateOut:'fadeout',top:!1,left:!1,refresh:!1,fps:4,hideelements:!1,showoverlay:!0,zIndex:100100,ismodal:!1,cancelfunc:b.prototype.hide,showfunc:null,cancelEvent:!0,cancelClass:'.floatbox-cancel',updateEvent:!1,updateClass:!1,unique:!0,overlayopacity:.5,isconfirm:!1},a.fn.tcFloatBox.instances=[],a.fn.tcFloatBox.Constructor=b,a.tcFloatBox=function(e){var d=a('body'),c=!1,f=d.map(function(){return a(this).data('tcfloatbox')||''}).get().some(function(a){return a===''});return f||e.unique?(c=new b(d,e),d.data('tcfloatbox',c)):(c=d.data('tcfloatbox'),c.init()),c}})(window.jQuery)
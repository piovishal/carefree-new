{"version":3,"file":"wc-braintree-cartflows.js","mappings":"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","sources":["webpack://wcBraintree/external window \"jQuery\"","webpack://wcBraintree/external window \"regeneratorRuntime\"","webpack://wcBraintree/external window [\"braintree\",\"client\"]","webpack://wcBraintree/external window [\"braintree\",\"threeDSecure\"]","webpack://wcBraintree/./node_modules/@babel/runtime/helpers/asyncToGenerator.js","webpack://wcBraintree/./node_modules/@babel/runtime/helpers/defineProperty.js","webpack://wcBraintree/./node_modules/@babel/runtime/helpers/interopRequireDefault.js","webpack://wcBraintree/webpack/bootstrap","webpack://wcBraintree/./packages/cartflows/assets/js/cartflows.js"],"sourcesContent":["module.exports = window[\"jQuery\"];","module.exports = window[\"regeneratorRuntime\"];","module.exports = window[\"braintree\"][\"client\"];","module.exports = window[\"braintree\"][\"threeDSecure\"];","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nmodule.exports = _asyncToGenerator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nmodule.exports = _interopRequireDefault, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import braintreeClient from '@braintree/client';\nimport threeDSecure from '@braintree/three-d-secure';\nimport $ from 'jquery';\n\nconst wcBraintreeData = cartflows_offer.wcBraintree;\n\nconst client = new Promise((resolve, reject) => {\n    braintreeClient.create({\n        authorization: wcBraintreeData.clientToken\n    }, (err, clientInstance) => {\n        if (err) {\n            console.log(err);\n            reject()\n        } else {\n            resolve(clientInstance);\n        }\n    })\n});\n\nconst _3dSecure = new Promise(async (resolve, reject) => {\n    const clientInstance = await client;\n    threeDSecure.create({\n        version: 2,\n        client: clientInstance\n    }, (err, instance) => {\n        if (err) {\n            return reject(err);\n        }\n        return resolve(instance);\n    });\n})\n\nlet currentButton;\n\nconst initialize = () => {\n    window.addEventListener('hashchange', handleHashChange);\n    $(document.body).on('click', 'a[href*=\"wcf-up-offer\"], a[href*=\"wcf-down-offer\"]', handleButtonClick);\n}\n\nconst handleButtonClick = (e) => {\n    currentButton = $(e.currentTarget);\n}\n\nconst handleHashChange = async (e) => {\n    var match = e.newURL.match(/wcBraintree3DS=(.*)/);\n    if (match) {\n        try {\n            var obj = JSON.parse(window.atob(decodeURIComponent(match[1])));\n            if (obj.nonce) {\n                history.pushState({}, '', window.location.pathname + window.location.search);\n                // process the vaulted nonce\n                _3dSecure.then(instance => {\n                    instance.verifyCard({\n                        amount: obj.amount,\n                        nonce: obj.nonce,\n                        bin: obj.details.bin,\n                        ...wcBraintreeData?.order?.threeDSData,\n                        onLookupComplete: (data, next) => next(),\n                    }, async (err, payload) => {\n                        if (err) {\n                            displayMessage(err.message);\n                        } else {\n                            if (payload.liabilityShifted) {\n                                // save the nonce to the order\n                                await storeVaultedNonce({\n                                    nonce: payload.nonce,\n                                    order_id: cartflows_offer.order_id,\n                                    step_id: cartflows_offer.step_id\n                                });\n                                // nonce saved, trigger click\n                                currentButton.click();\n                            } else {\n                                displayMessage(wcBraintreeData.threeDSFailedMsg);\n                            }\n                        }\n                    });\n                })\n            } else if (obj.error) {\n                displayMessage(obj.message);\n            }\n        } catch (err) {\n\n        }\n    }\n    return true;\n}\n\nconst storeVaultedNonce = ({nonce, order_id, step_id}) => {\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            url: wcBraintreeData?.ajax_url,\n            method: 'POST',\n            dataType: 'json',\n            data: {nonce, order_id, step_id, security: wcBraintreeData?.security?.storeVaultedNonce}\n        }).done(result => {\n            if (result.success) {\n                resolve();\n            } else {\n                // display error\n            }\n        }).fail(() => {\n            reject();\n        })\n    })\n}\n\nconst displayMessage = (msg) => {\n    $('body').trigger('wcf-update-msg', [msg, 'wcf-payment-error']);\n    setTimeout(() => {\n        $(document.body).trigger('wcf-hide-loader');\n        $(document.body).trigger('wcf-update-msg', [wcBraintreeData.successMessage, 'wcf-payment-success']);\n    }, wcBraintreeData.timeout);\n}\n\ninitialize();"],"names":["module","exports","window","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","fn","self","this","args","arguments","apply","err","undefined","__esModule","obj","Object","defineProperty","enumerable","configurable","writable","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","currentButton","wcBraintreeData","cartflows_offer","wcBraintree","client","braintreeClient","create","authorization","clientToken","clientInstance","console","log","_3dSecure","threeDSecure","version","instance","handleHashChange","e","match","newURL","JSON","parse","atob","decodeURIComponent","nonce","history","pushState","location","pathname","search","verifyCard","amount","bin","details","order","threeDSData","onLookupComplete","data","next","payload","displayMessage","message","liabilityShifted","storeVaultedNonce","order_id","step_id","click","threeDSFailedMsg","$","ajax","url","ajax_url","method","dataType","security","result","success","fail","msg","trigger","setTimeout","document","body","successMessage","timeout","addEventListener","on","currentTarget"],"sourceRoot":""}
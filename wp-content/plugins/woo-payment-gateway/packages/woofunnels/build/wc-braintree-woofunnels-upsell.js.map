{"version":3,"file":"wc-braintree-woofunnels-upsell.js","mappings":"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","sources":["webpack://wcBraintree/external window \"jQuery\"","webpack://wcBraintree/external window [\"braintree\",\"dataCollector\"]","webpack://wcBraintree/external window [\"braintree\",\"threeDSecure\"]","webpack://wcBraintree/external window [\"wp\",\"apiFetch\"]","webpack://wcBraintree/./node_modules/@babel/runtime/helpers/defineProperty.js","webpack://wcBraintree/./node_modules/@babel/runtime/helpers/interopRequireDefault.js","webpack://wcBraintree/webpack/bootstrap","webpack://wcBraintree/./packages/woofunnels/assets/js/index.js"],"sourcesContent":["module.exports = window[\"jQuery\"];","module.exports = window[\"braintree\"][\"dataCollector\"];","module.exports = window[\"braintree\"][\"threeDSecure\"];","module.exports = window[\"wp\"][\"apiFetch\"];","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nmodule.exports = _interopRequireDefault, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import threeDSecure from '@braintree/three-d-secure';\nimport dataCollector from '@braintree/data-collector';\nimport $ from 'jquery';\nimport apiFetch from '@wordpress/api-fetch';\n\nlet threeDSecureInstance = null;\n\nlet params = null;\n\nconst loadDataCollector = () => {\n    dataCollector.create({\n        authorization: getData('clientToken'),\n        kount: true,\n    }).then(instance => setData('dataCollector', instance)).catch(error => {\n        console.log(error);\n    });\n}\n\nconst getData = (key, defaultValue = '') => {\n    return params?.[key] || defaultValue;\n}\n\nconst setData = (key, value) => {\n    params[key] = value;\n}\n\nconst setThreeDSecureInstance = (instance) => {\n    threeDSecureInstance = instance;\n}\n\nconst loadThreeDSecure = () => {\n    threeDSecure.create({\n        authorization: getData('clientToken'),\n        version: 2\n    }).then(instance => {\n        setThreeDSecureInstance(instance)\n        initEvents();\n    }).catch(error => {\n        console.log(error);\n        addClientError(error);\n    })\n}\n\nconst initialize = () => {\n    $(document).on('wfocuBucketCreated', onBucketCreated);\n}\n\nconst initEvents = () => {\n    $(document).on('wfocu_external', onHandleSubmit);\n}\n\nconst onBucketCreated = (e, bucket) => {\n    params = window?.wfocu_vars?.wcBraintree;\n    params.bucket = bucket;\n    loadThreeDSecure();\n    loadDataCollector();\n}\n\nconst onHandleSubmit = (e, bucket) => {\n    if (0 < bucket.getTotal() && !getData('threeDSecureComplete', false)) {\n        const vaultedNonce = getData('vaultedNonce');\n        bucket.inOfferTransaction = true;\n        const args = {\n            amount: bucket.formatPrice(bucket.getTotal(), 2, \"\", \".\"),\n            nonce: vaultedNonce?.nonce,\n            bin: vaultedNonce?.details.bin,\n            onLookupComplete: (data, next) => {\n                next()\n            },\n            ...getData('threeDSecureData')\n        }\n        threeDSecureInstance.verifyCard(args).then(payload => {\n            if ((!payload.liabilityShifted && !payload.liabilityShiftPossible) || payload.liabilityShifted) {\n                wfocuCommons.addFilter('wfocu_front_charge_data', (e) => {\n                    e._wc_braintree_woofunnels_3ds_nonce = payload.nonce;\n                    if (getData('dataCollector')) {\n                        e[`${getData('paymentMethod')}_device_data`] = getData('dataCollector')?.deviceData\n                    }\n                    setData('threeDSecureComplete', true);\n                    return e;\n                });\n                bucket.sendBucket();\n            } else {\n                getData('bucket')?.swal?.hide();\n                resetPaymentProcess();\n                fetchVaultedNonce();\n            }\n        }).catch(error => {\n            console.log(error);\n            if (error?.details?.originalError?.details?.originalError?.error?.message) {\n                const message = error.details.originalError.details.originalError.error.message;\n                displayNotice(message, 'warning');\n            }\n            addClientError(error);\n        });\n    } else {\n        resetPaymentProcess();\n    }\n}\n\nconst addClientError = (error) => {\n    wfocuCommons.addFilter('wfocu_front_charge_data', (e) => {\n        e._client_error = error?.message;\n        return e;\n    });\n    resetPaymentProcess();\n}\n\nconst resetPaymentProcess = () => {\n    getData('bucket').inOfferTransaction = false;\n    getData('bucket').EnableButtonState();\n    getData('bucket').HasEventRunning = false;\n}\nconst displayNotice = (message, type) => {\n    getData('bucket')?.swal?.show({text: message, type});\n    setTimeout(() => {\n        getData('bucket')?.swal?.hide();\n    }, 3000);\n}\n\nconst fetchVaultedNonce = () => {\n    apiFetch({\n        path: '/wc-braintree/v1/3ds/vaulted_nonce',\n        method: 'POST',\n        data: {token: getData('paymentMethodToken')}\n    }).then(response => {\n        setData('vaultedNonce', response.data);\n    }).catch(error => console.log(error));\n}\n\ninitialize();"],"names":["module","exports","window","obj","key","value","Object","defineProperty","enumerable","configurable","writable","__esModule","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","threeDSecureInstance","params","getData","defaultValue","setData","initEvents","$","document","on","onHandleSubmit","e","bucket","getTotal","vaultedNonce","inOfferTransaction","args","amount","formatPrice","nonce","bin","details","onLookupComplete","data","next","verifyCard","then","payload","liabilityShifted","liabilityShiftPossible","wfocuCommons","addFilter","_wc_braintree_woofunnels_3ds_nonce","deviceData","sendBucket","swal","hide","resetPaymentProcess","fetchVaultedNonce","catch","error","console","log","originalError","message","displayNotice","addClientError","_client_error","EnableButtonState","HasEventRunning","type","show","text","setTimeout","apiFetch","path","method","token","response","wfocu_vars","wcBraintree","threeDSecure","create","authorization","version","instance","setThreeDSecureInstance","dataCollector","kount"],"sourceRoot":""}
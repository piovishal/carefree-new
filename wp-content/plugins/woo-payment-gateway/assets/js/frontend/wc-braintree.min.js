!function(o){function t(t,e){this.params=t,this.page=e,this.fields=new Map(Object.keys(this.params).map(function(t){var e=this.params[t].value;return[t,e=null===e?"":e]}.bind(this))),("checkout"===e||"cart"===e&&o(document.body).is(".woocommerce-checkout"))&&(o("form.checkout").on("change",".input-text, select",this.onChange.bind(this)),o("form.checkout").on("change",'[name="ship_to_different_address"]',this.on_ship_to_address_change.bind(this)),this.init_i18n(),o('[name="ship_to_different_address"]').is(":checked")?this.update_required_fields(o("#shipping_country").val(),"shipping_country"):this.update_required_fields(o("#billing_country").val(),"billing_country"))}window.wc_braintree={clazzes:[],gateways:[]},"undefined"==typeof wc_braintree_global_params&&(wc_braintree_global_params={}),wc_braintree.register=function(t){this.clazzes.push(t),this.isReady()&&this.create_instance(t)},wc_braintree.isReady=function(){return"undefined"!=typeof wc_braintree.clientInstance},wc_braintree.create_instance=function(t){t=new t;Promise.resolve(t.create_instance(this.clientInstance,wc_braintree_client_token))["catch"](function(t){console.log(t)}),this.gateways.push(t)},wc_braintree.triggerClientReady=function(t){this.clientInstance=t,this.clazzes.forEach(function(t){this.create_instance(t)}.bind(this))},wc_braintree.triggerClientUpdate=function(t){this.clientInstance=t,this.gateways.forEach(function(t){Promise.resolve(t.create_instance(this.clientInstance,wc_braintree_client_token,this.merchant_account))["catch"](function(t){console.log(t)})}.bind(this))},"undefined"==typeof wc_braintree_checkout_fields&&(wc_braintree_checkout_fields=[]),wc_braintree.BaseGateway=function(){this.gateway_id=this.params.gateway,this.container="li.payment_method_"+this.gateway_id,this.nonce_selector='[name="'+this.params.nonce_selector+'"]',this.device_data_selector='[name="'+this.params.device_data_selector+'"]',this.tokenized_response_selector='[name="'+this.params.tokenized_response_selector+'"]',this.fields=e,this.initialize()},wc_braintree.BaseGateway.prototype.create_instance=function(t,e){},wc_braintree.BaseGateway.prototype.get_page=function(){var t=wc_braintree_client_manager_params.page_id;return t="cart"===t&&o(document.body).is(".woocommerce-checkout")?"checkout":t},wc_braintree.BaseGateway.prototype.is_checkout_page=function(){return"checkout"===this.get_page()},wc_braintree.BaseGateway.prototype.get_gateway_data=function(){var t=o(this.container).find(".woocommerce_"+this.gateway_id+"_data").data("gateway");return void 0===(t=void 0===t&&this.is_checkout_page()&&void 0===(t=o("form.checkout").find(".woocommerce_"+this.gateway_id+"_data").data("gateway"))?o(".woocommerce_"+this.gateway_id+"_data").data("gateway"):t)?{}:t},wc_braintree.BaseGateway.prototype.set_gateway_data=function(t){o(this.container).find(".woocommerce_"+this.gateway_id+"_data").data("gateway",t)},wc_braintree.BaseGateway.prototype.needs_shipping=function(){return this.get_gateway_data().needs_shipping},wc_braintree.BaseGateway.prototype.get_items=function(){return this.get_gateway_data().items},wc_braintree.BaseGateway.prototype.set_items=function(t){var e=this.get_gateway_data();e.items=t,this.set_gateway_data(e)},wc_braintree.BaseGateway.prototype.set_cart_shipping=function(t){var e=this.get_gateway_data();e.cart_shipping=t,this.set_gateway_data(e)},wc_braintree.BaseGateway.prototype.get_shipping_options=function(){return this.get_gateway_data().shipping_options},wc_braintree.BaseGateway.prototype.set_shipping_options=function(t){var e=this.get_gateway_data();e.shipping_options=t,this.set_gateway_data(e)},wc_braintree.BaseGateway.prototype.get_currency=function(){return this.get_gateway_data().currency},wc_braintree.BaseGateway.prototype.get_total=function(){return this.get_gateway_data().total},wc_braintree.BaseGateway.prototype.set_total=function(t){var e=this.get_gateway_data();e.total=t,this.set_gateway_data(e)},wc_braintree.BaseGateway.prototype.get_order_total=function(){return this.get_gateway_data().order_total},wc_braintree.BaseGateway.prototype.get_price_label=function(){return this.get_gateway_data().price_label},wc_braintree.BaseGateway.prototype.block=function(){o().block&&o.blockUI({message:null,overlayCSS:{background:"#fff",opacity:.6}})},wc_braintree.BaseGateway.prototype.unblock=function(){o().block&&o.unblockUI()},wc_braintree.BaseGateway.prototype.get_button=function(){return this.$button},wc_braintree.BaseGateway.prototype.get_merchant_account=function(){return this.get_gateway_data().merchant_account},wc_braintree.BaseGateway.prototype.set_device_data=function(){this.dataCollectorInstance&&(o(this.device_data_selector).val(this.dataCollectorInstance.deviceData),this.fields.set(this.gateway_id+"_device_data",this.dataCollectorInstance.deviceData))},wc_braintree.BaseGateway.prototype.set_nonce=function(t){o(this.nonce_selector).val(t),this.fields.set(this.gateway_id+"_nonce_key",t)},wc_braintree.BaseGateway.prototype.set_tokeninzed_response=function(t){this.fields.set(this.gateway_id+"_tokenized_response",t)},wc_braintree.BaseGateway.prototype.set_payment_method=function(t){this.fields.set("payment_method",t)},wc_braintree.BaseGateway.prototype.get_form=function(){return o(this.container).closest("form")},wc_braintree.BaseGateway.prototype.initialize=function(){},wc_braintree.BaseGateway.prototype.is_valid_checkout=function(){return!0},wc_braintree.BaseGateway.prototype.get_address_hash=function(e){var i="";return["_first_name","_last_name","_address_1","_address_2","_postcode","_city","_state","_country"].forEach(function(t){i+=this.fields.get(e+t)}.bind(this)),i},wc_braintree.BaseGateway.prototype.is_valid_address=function(t,e,i){if(o.isEmptyObject(t))return!1;var n=this.get_address_mappings();void 0!==i&&i.forEach(function(t){-1<n.indexOf(t)&&n.splice(n.indexOf(t),1)});for(var a=0;a<n.length;a++){var s=n[a],r=this.fields[s]().required.call(this.fields,e);if(r&&(!t[s]||"undefined"==typeof t[s]||!this.fields.isValid(s,t[s],t)))return!1}return!0},wc_braintree.BaseGateway.prototype.get_address_object=function(e,i){var n={};return i=i||[],this.get_address_mappings().filter(function(t){return i.indexOf(t)<0}).forEach(function(t){n[t]=this.fields.get(t,e)}.bind(this)),n},wc_braintree.BaseGateway.prototype.form_to_data=function(t){var e,i=t.find("input").filter(function(t,e){return!o(e).is('[name^="add-to-cart"]')}.bind(this)).serializeArray(),n={};for(e in i){var a=i[e];n[a.name]=a.value}return n},wc_braintree.BaseGateway.prototype.ajax_before_send=function(t){0<this.params.user_id&&t.setRequestHeader("X-WP-Nonce",this.params._wp_rest_nonce)},wc_braintree.BaseGateway.prototype.add_to_cart=function(t){return t&&t.preventDefault(),new Promise(function(e,n){this.block();var t={product_id:this.get_product_data().id,variation_id:o('[name="variation_id"]').val(),qty:this.get_product_quantity(),payment_method:this.gateway_id,wc_braintree_currency:this.get_currency(),variation:this.get_product_variation_data()},i=this.get_form().find(':not([name="add-to-cart"],[name="quantity"],[name^="attribute_"])').serializeArray();if(i)for(var a in i)t[i[a].name]=i[a].value;o.ajax({url:this.params.routes.add_to_cart,method:"POST",dataType:"json",data:t,beforeSend:this.ajax_before_send.bind(this),success:function(t){this.unblock(),t.success?(this.set_total(t.data.total),this.set_cart_shipping(t.data.needs_shipping),e(t)):this.submit_error(t.messages)}.bind(this),error:function(t,e,i){this.unblock(),this.submit_error(i),n(i)}.bind(this)})}.bind(this))},wc_braintree.BaseGateway.prototype.process_checkout=function(){this.is_valid_checkout()?(this.block(),o.ajax({method:"POST",url:this.params.routes.checkout,data:o.extend({},this.fields.toJson(),{payment_method:this.gateway_id,page_id:this.get_page(),wc_braintree_currency:this.get_currency()}),dataType:"json",beforeSend:this.ajax_before_send.bind(this),success:function(t,e,i){t.reload?window.location.reload():"success"===t.result?window.location=t.redirect:(t.messages&&this.submit_error(t.messages),this.set_nonce(""),this.unblock())}.bind(this),error:function(t,e,i){this.set_nonce(""),this.submit_error(i),this.unblock()}.bind(this)})):this.submit_error(this.params.messages.terms)},wc_braintree.BaseGateway.prototype.update_shipping_address=function(t){return new Promise(function(e,n){o.ajax({method:"POST",url:this.params.routes.shipping_address,data:{payment_method:this.gateway_id,address:t,wc_braintree_currency:this.get_currency()},dataType:"json",beforeSend:this.ajax_before_send.bind(this),success:function(t){(t.code?n:(this.set_total(t.data.total),e))(t)}.bind(this),error:function(t,e,i){n(t,e,i)}.bind(this)})}.bind(this))},wc_braintree.BaseGateway.prototype.update_shipping_method=function(t){return new Promise(function(n,a){o.ajax({method:"POST",url:this.params.routes.shipping_method,data:{payment_method:this.gateway_id,shipping_method:t,wc_braintree_currency:this.get_currency()},dataType:"json",beforeSend:this.ajax_before_send.bind(this),success:function(t,e,i){(t.code?a:(this.set_selected_shipping_method(t.data.chosen_shipping_methods),this.set_total(t.data.total),n))(t)}.bind(this),error:function(t,e,i){a()}.bind(this)})}.bind(this))},wc_braintree.BaseGateway.prototype.update_shipping=function(t,e){return new Promise(function(n,a){o.ajax({method:"POST",url:this.params.routes.shipping,data:{payment_method:this.gateway_id,address:t,shipping_method:e,wc_braintree_currency:this.get_currency()},dataType:"json",beforeSend:this.ajax_before_send.bind(this),success:function(t,e,i){(t.code?a:(this.set_selected_shipping_method(t.data.chosen_shipping_methods),this.set_total(t.data.total),n))(t)}.bind(this),error:function(t){a(t)}.bind(this)})}.bind(this))},wc_braintree.BaseGateway.prototype.map_shipping_address=function(t){},wc_braintree.BaseGateway.prototype.set_selected_shipping_method=function(t){if(t&&("checkout"!==this.get_page()&&this.fields.set("shipping_method",t),o('[name^="shipping_method"]').length))for(var e in t)o('[name="shipping_method['+e+']"][value="'+t[e]+'"]').prop("checked",!0).trigger("change")},wc_braintree.BaseGateway.prototype.initialize_fraud_tools=function(){this.params.advanced_fraud.enabled&&braintree.dataCollector.create(this.get_fraud_tool_options(),function(t,e){if(t)return"DATA_COLLECTOR_KOUNT_NOT_ENABLED"===t.code?void 0:void this.submit_error(t);this.dataCollectorInstance=e,this.set_device_data()}.bind(this))},wc_braintree.BaseGateway.prototype.initialize_3d_secure=function(){this._3ds_enabled()&&braintree.threeDSecure.create({version:2,client:this.clientInstance},function(t,e){t?(this.threeds_error=t,this.submit_error(t)):this.threeDSecureInstance=e}.bind(this))},wc_braintree.BaseGateway.prototype._3ds_enabled=function(){return"config"in this&&this.config.threeDSecureEnabled},wc_braintree.BaseGateway.prototype.get_fraud_tool_options=function(){return{client:this.clientInstance,kount:!0}},wc_braintree.BaseGateway.prototype.on_payment_method_received=function(t){},wc_braintree.BaseGateway.prototype.submit_error=function(t,e){this.clear_error(),o(document.body).triggerHandler("wc_braintree_submit_error",{error:t,element:this.message_container,ignore:e})},wc_braintree.BaseGateway.prototype.clear_error=function(){o("#wc_braintree_checkout_error").remove()},wc_braintree.BaseGateway.prototype.terms_updated=function(){},wc_braintree.BaseGateway.prototype.get_first_name=function(t){return this.fields.exists(t+"_first_name")?this.fields.get(t+"_first_name"):""},wc_braintree.BaseGateway.prototype.get_last_name=function(t){return this.fields.exists(t+"_last_name")?this.fields.get(t+"_last_name"):""},wc_braintree.BaseGateway.prototype.get_shipping_prefix=function(){return"shipping"},wc_braintree.BaseGateway.prototype.populate_address_fields=function(t,e){for(var i in t)this.fields.set(i,t[i],e)},wc_braintree.BaseGateway.prototype.populate_billing_address=function(t){this.populate_address_fields(t,"billing")},wc_braintree.BaseGateway.prototype.populate_shipping_address=function(t){this.populate_address_fields(t,"shipping")},wc_braintree.BaseGateway.prototype.get_product_variation_data=function(){var n={};return this.is_variable_product()&&o('.variations [name^="attribute_"]').each(function(t,e){var e=o(e),i=e.data("attribute_name")||e.attr("name");n[i]=e.val()}),n},wc_braintree.CartGateway=function(){this.container="li.wc_braintree_cart_gateway_"+this.gateway_id,this.message_container=".shop_table",this.form_id="#wc-braintree-cart-fields-form",o(document.body).on("change",'[name="terms"]',this.terms_updated.bind(this))},wc_braintree.CartGateway.prototype.on_payment_method_received=function(t){this.process_checkout()},wc_braintree.CartGateway.prototype.get_form=function(){return o(this.form_id)},wc_braintree.CartGateway.prototype.is_valid_checkout=function(){return!(o('[name="terms"]').length&&!o('[name="terms"]').is(":checked"))},wc_braintree.CartGateway.prototype.add_cart_totals_class=function(){o(".cart_totals").addClass("braintree_cart_gateway_active")},wc_braintree.ProductGateway=function(){this.container="li.wc_braintree_product_gateway_"+this.gateway_id,this.message_container="div.product",this.buttonWidth=o("form div.quantity").outerWidth(!0)+o(".single_add_to_cart_button").outerWidth(),this.get_form().on("found_variation",this.found_variation.bind(this)),this.get_form().on("reset_data",this.reset_variation_data.bind(this)),setTimeout(function(){this.is_variable_product()&&this.is_variable_product_selected()&&this.enable_payment_button()}.bind(this),3e3),o(this.container).css("max-width",this.buttonWidth+"px")},wc_braintree.ProductGateway.prototype.is_variable_product=function(){return 0<o('[name="variation_id"]').length},wc_braintree.ProductGateway.prototype.is_variable_product_selected=function(){var t=o('input[name="variation_id"]').val();return!!t&&"0"!=t},wc_braintree.ProductGateway.prototype.on_payment_method_received=function(){this.process_checkout()},wc_braintree.ProductGateway.prototype.get_product_data=function(){return this.get_gateway_data().product},wc_braintree.ProductGateway.prototype.set_product_data=function(t){var e=this.get_gateway_data();e.product=t,this.set_gateway_data(e)},wc_braintree.ProductGateway.prototype.get_product_quantity=function(){return parseInt(o('[name="quantity"]').val())},wc_braintree.ProductGateway.prototype.get_product_amount=function(){return this.get_product_data().price*this.get_product_quantity()},wc_braintree.ProductGateway.prototype.found_variation=function(t,e){var i=this.get_gateway_data();i.product.price=e.display_price,i.needs_shipping=!e.is_virtual,i.product.variation=e,this.set_gateway_data(i),this.$button&&this.get_button().prop("disabled",!1).removeClass("disabled")},wc_braintree.ProductGateway.prototype.reset_variation_data=function(){var t=this.get_product_data();t.variation=!1,this.set_product_data(t),this.disable_payment_button()},wc_braintree.ProductGateway.prototype.disable_payment_button=function(){this.$button&&this.get_button().prop("disabled",!0).addClass("disabled")},wc_braintree.ProductGateway.prototype.enable_payment_button=function(){this.$button&&this.get_button().prop("disabled",!1).removeClass("disabled")},wc_braintree.ProductGateway.prototype.needs_shipping=function(){return wc_braintree.BaseGateway.prototype.needs_shipping.apply(this,arguments)||this.get_gateway_data().cart_shipping},wc_braintree.CheckoutGateway=function(){this.payment_method_received=!1,this.token_selector='[name="'+this.params.token_selector+'"]',this.payment_type_selector='[name="'+this.params.payment_type_selector+'"]',this.container=this.message_container="li.payment_method_"+this.gateway_id,this.banner_container=".wc_braintree_banner_gateway_"+this.gateway_id,this.list_container="li.payment_method_"+this.gateway_id,this.banner_enabled="1"===this.params.banner_enabled,this.last_error="",o(this.container).closest("form").on("checkout_place_order_"+this.gateway_id,this.pre_submit_validations.bind(this)),o(this.container).closest("form").on("checkout_place_order_"+this.gateway_id,this.woocommerce_form_submit.bind(this)),o(document.body).on("updated_checkout",this.updated_checkout.bind(this)),o(document.body).on("cfw_updated_checkout",this.updated_checkout.bind(this)),o(document.body).on("checkout_error",this.checkout_error.bind(this)),o(document.body).on("change",'[name="terms"]',this.terms_updated.bind(this)),this.banner_enabled&&o(".woocommerce-billing-fields").length&&o(this.banner_container).css("max-width",o(".woocommerce-billing-fields").outerWidth(!0)),this.hasOrderReviewParams(),this.container_styling()},wc_braintree.CheckoutGateway.prototype.on_payment_method_received=function(t){this.tokenize_response=t,this.payment_method_received=!0,this.set_nonce(t.nonce),this.hide_payment_button(),this.show_place_order()},wc_braintree.CheckoutGateway.prototype.hasOrderReviewParams=function(){var t=window.location.search.match(/_braintree_order_review=(.+)/);if(t&&1<t.length)try{var e=JSON.parse(window.atob(decodeURIComponent(t[1])));this.gateway_id===e.payment_method&&(this.payment_method_received=!0,this.set_nonce(e.payment_nonce),this.set_use_nonce_option(!0),history.pushState({},"",window.location.pathname))}catch(i){console.log(i)}},wc_braintree.CheckoutGateway.prototype.hide_payment_button=function(){this.$button&&this.$button.hide()},wc_braintree.CheckoutGateway.prototype.show_payment_button=function(){this.$button&&this.$button.show()},wc_braintree.CheckoutGateway.prototype.hide_place_order=function(){o("#place_order").addClass("wc-braintree-hide")},wc_braintree.CheckoutGateway.prototype.show_place_order=function(){o("#place_order").removeClass("wc-braintree-hide")},wc_braintree.CheckoutGateway.prototype.get_shipping_prefix=function(){return this.needs_shipping()&&o('[name="ship_to_different_address"]').is(":checked")?"shipping":"billing"},wc_braintree.CheckoutGateway.prototype.woocommerce_form_submit=function(){return!!this.is_payment_method_selected()||this.payment_method_received},wc_braintree.CheckoutGateway.prototype.is_valid_checkout=function(){return!(o('[name="terms"]').length&&!o('[name="terms"]').is(":checked"))},wc_braintree.CheckoutGateway.prototype.pre_submit_validations=function(t){return!!this.is_valid_checkout()||(void 0!==t&&t.stopImmediatePropagation(),this.submit_error(this.params.messages.terms),!1)},wc_braintree.CheckoutGateway.prototype.payment_gateway_changed=function(t,e){e===this.gateway_id?this.is_payment_method_selected()||this.payment_method_received?(this.hide_payment_button(),this.show_place_order()):(this.show_payment_button(),this.hide_place_order()):this.hide_payment_button()},wc_braintree.CheckoutGateway.prototype.create_button=function(){},wc_braintree.CheckoutGateway.prototype.update_checkout=function(){},wc_braintree.CheckoutGateway.prototype.updated_checkout=function(t){this.create_button(),this.container_styling(),this.fields.isEmpty(this.gateway_id+"_nonce_key")||this.set_nonce(this.fields.get(this.gateway_id+"_nonce_key")),this.payment_method_received&&o("#"+this.gateway_id+"_use_nonce").trigger("click")},wc_braintree.CheckoutGateway.prototype.checkout_error=function(t){this.is_gateway_selected()&&this.has_checkout_error()&&(this.payment_method_received=!1,this.tokenize_response=null,this.payment_gateway_changed(null,this.gateway_id))},wc_braintree.CheckoutGateway.prototype.is_gateway_selected=function(){return this.get_selected_gateway()===this.gateway_id},wc_braintree.CheckoutGateway.prototype.get_selected_gateway=function(){return o('input[name="payment_method"]:checked').val()},wc_braintree.CheckoutGateway.prototype.has_checkout_error=function(){return 0<o("#wc_braintree_checkout_error").length},wc_braintree.CheckoutGateway.prototype.is_payment_method_selected=function(){return!!o(this.token_selector).length&&"token"===o(this.payment_type_selector+":checked").val()},wc_braintree.CheckoutGateway.prototype.display_saved_methods=function(t,e){this.gateway_id==e&&this.$button&&this.is_payment_method_selected()&&(this.hide_payment_button(),this.show_place_order())},wc_braintree.CheckoutGateway.prototype.display_new_payment_method_container=function(t,e){this.gateway_id!=e||!this.$button||this.payment_method_received||this.is_payment_method_selected()||(this.$button.show(),this.hide_place_order())},wc_braintree.CheckoutGateway.prototype.get_payment_token=function(){return o(this.token_selector).val()},wc_braintree.blockUI={message:null,overlayCSS:{background:"#fff",opacity:.6}},wc_braintree.CheckoutGateway.prototype.set_use_nonce_option=function(t){o("#"+this.gateway_id+"_use_nonce").prop("checked",t).trigger("click")},wc_braintree.CheckoutGateway.prototype.set_payment_method=function(t){o('[name="payment_method"][value="'+t+'"]').prop("checked",!0).trigger("click")},wc_braintree.CheckoutGateway.prototype.show_checkout_gateway=function(){o(this.container).show()},wc_braintree.CheckoutGateway.prototype.hide_checkout_gateway=function(){o(this.container).hide()},wc_braintree.CheckoutGateway.prototype.maybe_set_ship_to_different=function(){o('[name="ship_to_different_address"]').length&&o('[name="ship_to_different_address"]').prop("checked",this.get_address_hash("billing")!==this.get_address_hash("shipping")).trigger("change")},wc_braintree.CheckoutGateway.prototype.validate_checkout_fields=function(){var t;return this.last_error="",["checkout","order_pay"].indexOf(this.get_page())<0||(t=!0,this.fields.validateFields("billing")?this.needs_shipping()&&o("#ship-to-different-address-checkbox").is(":checked")?this.fields.validateFields("shipping")||(t=!1,this.last_error="shipping"):this.is_valid_checkout()||(t=!1,this.last_error="terms"):(t=!1,this.last_error="billing"),"terms"===this.last_error?this.submit_error(this.params.messages.terms):-1<["billing","shipping"].indexOf(this.last_error)&&this.submit_error(this.params.messages.required_field),t)},wc_braintree.CheckoutGateway.prototype.description_styling=function(){0==o(this.container).find("p").length&&o(this.container).addClass("no-description")},wc_braintree.CheckoutGateway.prototype.container_styling=function(){this.description_styling(),o(this.container).find(".wc-braintree-payment-gateway").is(".has_methods")&&o(this.container).find("div.payment_box").addClass("has-methods")},wc_braintree.CheckoutGateway.prototype.disable_place_order=function(){o("#place_order").prop("disabled",!0)},wc_braintree.CheckoutGateway.prototype.enable_place_order=function(){o("#place_order").prop("disabled",!1)},wc_braintree.PayPal=function(){wc_braintree.BaseGateway.call(this),this.actions=new wc_braintree.PayPal.Actions,this.buttons=new wc_braintree.PayPal.Buttons},wc_braintree.PayPal.prototype=Object.create(wc_braintree.BaseGateway.prototype),wc_braintree.PayPal.prototype.set_selected_shipping_method=function(t){!t||this.is_checkout_page()||this.fields.set("shipping_method",t)},wc_braintree.PayPal.Actions=function(){this.actions={}},wc_braintree.PayPal.Actions.prototype.enable=function(){for(var t in this.actions)this.actions[t].enable()},wc_braintree.PayPal.Actions.prototype.disable=function(){for(var t in this.actions)this.actions[t].disable()},wc_braintree.PayPal.Actions.prototype.set_actions=function(t,e){this.actions[e]=t},wc_braintree.PayPal.Buttons=function(){this.buttons={}},wc_braintree.PayPal.Buttons.prototype.set_button=function(t,e){this.buttons[e]=t},wc_braintree.PayPal.Buttons.prototype.get_button=function(t){return!(!this.buttons||!this.buttons[t])&&this.buttons[t]},wc_braintree.PayPal.Buttons.prototype.clear_buttons=function(t){t.forEach(function(t){t in this.buttons&&this.buttons[t].close()}.bind(this))},wc_braintree.PayPal.Buttons.prototype.clear=function(t){t in this.buttons&&this.buttons[t].close()},wc_braintree.PayPal.prototype.create_instance=function(e,a){return new Promise(function(i,n){if(this.clientInstance=e,this.config=e.getConfiguration().gatewayConfiguration,this.client_token=a,this.config.paypal||!this.config.paypalEnabled){if(!this.config.paypalEnabled||null===this.config.paypal.clientId)return this.submit_error({code:"PAYPAL_LINKED_ACCOUNT_"+this.config.environment.toUpperCase()}),n();if(this.config.paypal.currencyIsoCode.toLowerCase()!==this.get_currency().toLowerCase())return this.last_error="NO_MERCHANT_ACCOUNT",t="No Braintree merchant account was found for currency %s. Ensure you have imported".replace("%s",this.get_currency())+" your merchant accounts in the plugin settings and that you have a merchant account for this currency.",console.log(t),n(t)}if("undefined"==typeof window.paypal)return this.submit_error("There was an error loading the PayPal SDK. Please provide the following details to your plugin developer.PayPal config: "+JSON.stringify(this.config.paypal)+"PayPal SDK query: "+o("#wc-braintree-paypal-checkout-js").attr("src")),n();this.is_checkout_page()||this.create_button(),this.initialize_fraud_tools();var t=function(){var t={client:e,authorization:a};return this.get_merchant_account()?t.merchantAccountId=this.get_merchant_account():this.config.paypal.merchantAccountId&&(t.merchantAccountId=this.config.paypal.merchantAccountId),t}.bind(this)();braintree.paypalCheckout.create(t,function(t,e){(t?(this.submit_error(t),n):(this.paypalInstance=e,i))()}.bind(this))}.bind(this))},wc_braintree.PayPal.prototype.get_fraud_tool_options=function(){return o.extend({},wc_braintree.BaseGateway.prototype.get_fraud_tool_options.call(this),{paypal:!0})},wc_braintree.PayPal.prototype.create_button=function(){return new Promise(function(t,e){var i=this.get_button_container();if(i.find(".paypal-buttons").length)return t(!0);i.length?(this.get_funding().sort(function(t,e){return this.params.button_sorting.indexOf(t)-this.params.button_sorting.indexOf(e)}.bind(this)).forEach(function(t){this.buttons.set_button(paypal.Buttons(this.render_options(t)),t),this.buttons.get_button(t).isEligible()&&(this.buttons.get_button(t).render(i[0]),i.addClass(t+"-active"))}.bind(this)),this.$button=i.find(".paypal-buttons"),t(!0)):t(!1)}.bind(this))},wc_braintree.PayPal.prototype.render_options=function(i){var t={fundingSource:i,style:this.get_button_style(i),onInit:function(t,e){this.actions.set_actions(e,i)}.bind(this),onClick:function(t){}.bind(this),onApprove:function(t,e){return this.paypalInstance.tokenizePayment(t).then(function(t){this.handle_tokenize_response(t)}.bind(this))["catch"](function(t){}.bind(this))}.bind(this),onCancel:function(t){}.bind(this),onError:function(t){"object"==typeof t&&"toString"in t&&-1<t.toString().indexOf("Expected an order id")?t={code:"PAYPAL_INVALID_CLIENT"}:this.last_error&&"NO_MERCHANT_ACCOUNT"===this.last_error&&(t={code:"NO_MERCHANT_ACCOUNT"}),this.submit_error(t)}.bind(this),onDestroy:function(){}.bind(this)};return this.needs_shipping()&&(t.onShippingChange=function(t,e){var i;return this.is_checkout_page()?e.resolve():(i=t.shipping_address,t=t.selected_shipping_option?t.selected_shipping_option.id:null,this.update_shipping({city:i.city,state:i.state,postcode:i.postal_code,country:i.country_code},t).then(function(t){if(this.is_checkout_flow()&&t.data[this.gateway_id])return e.order.patch(t.data[this.gateway_id].patch).then(function(){e.resolve()}.bind(this));e.resolve()}.bind(this))["catch"](function(t){return t.code&&"shipping-error"===t.code?e.reject():e.resolve()}))}.bind(this)),this.is_checkout_flow()?t.createOrder=this.create_payment.bind(this):t.createBillingAgreement=this.create_payment.bind(this),t},wc_braintree.PayPal.prototype.create_payment=function(){var e=this.get_options();return this.is_checkout_page()&&this.needs_shipping()&&(this.shipping_address=this.get_address_object(this.get_shipping_prefix(),["phone"])),this.paypalInstance.createPayment(e).then(function(t){return t}.bind(this))["catch"](function(t){""==this.get_merchant_account()?t.code="PAYPAL_MERCHANT_ACCOUNT_EMPTY":e.shippingAddressOverride&&(t.code="PAYPAL_INVALID_ADDRESS"),this.submit_error(t)}.bind(this))},wc_braintree.PayPal.prototype.handle_tokenize_response=function(t){this.tokenize_response=t,this.set_nonce(t.nonce),this.set_device_data(),this.payment_method_received=!0,this.update_addresses(t.details),this.fields.set("payment_method",this.gateway_id),this.on_payment_method_received(t)},wc_braintree.PayPal.prototype.get_button_style=function(t){return paypal.FUNDING.CARD===t?Object.assign({},this.params.button_style,this.params.card_button):paypal.FUNDING.CREDIT===t?Object.assign({},this.params.button_style,this.params.credit_button):paypal.FUNDING.PAYLATER===t?Object.assign({},this.params.button_style,this.params.bnpl.button):this.params.button_style},wc_braintree.PayPal.prototype.get_options=function(){var t,e={amount:this.get_total(),enableShippingAddress:this.needs_shipping(),shippingAddressEditable:this.needs_shipping()};return this.needs_shipping()&&(t=this.get_shipping_prefix(),this.is_valid_address(this.get_address_object(t),t,["phone"])&&(e.shippingAddressOverride=this.get_address_object(t))),e=o.extend({},this.params.options,e)},wc_braintree.PayPal.prototype.get_funding=function(){return[paypal.FUNDING.PAYPAL]},wc_braintree.PayPal.prototype.get_button_container=function(){var t=o("#place_order").parent();return t.find(".wc-braintree-paypal-button-container").length||o("#place_order").after('<div class="wc-braintree-paypal-button-container"></div>'),t.find(".wc-braintree-paypal-button-container")},wc_braintree.PayPal.prototype.is_credit_enabled=function(t){return-1<["cart","checkout"].indexOf(t)?this.params.bnpl.enabled&&-1<this.params.bnpl.sections.indexOf(t):"product"===t&&this.params.bnpl.enabled},wc_braintree.PayPal.prototype.is_bnpl_msg_enabled=function(t){return-1<["cart","checkout"].indexOf(t)?this.params.bnpl.msg.can_show&&-1<this.params.bnpl.msg.sections.indexOf(t)&&0<this.get_order_total():"product"===t&&this.params.bnpl.msg.enabled},wc_braintree.PayPal.prototype.create_bnpl_msg=function(t,e){this.is_bnpl_msg_enabled(t)&&o(e).length&&(o(e).parent().find(".wc-braintree-pay-later-msg").length||o(e).after('<div class="wc-braintree-pay-later-msg"></div>'),paypal.Messages({amount:function(){return"product"===t?this.get_product_amount():this.get_total()}.bind(this)(),currency:this.get_currency(),placement:this.get_message_placement(),style:{layout:"text",logo:{type:"primary",position:"left"},text:{color:this.params.bnpl.txt_color}}}).render(o(e).parent().find(".wc-braintree-pay-later-msg")[0]))},wc_braintree.PayPal.prototype.get_message_placement=function(){return"checkout"!==this.get_page()?this.get_page():"payment"},wc_braintree.PayPal.prototype.update_addresses=function(t,e){var i;this.is_valid_address(this.get_address_object("billing"),"billing")&&!t.billingAddress||!(t.billingAddress||t.shippingAddress&&!o('[name="ship_to_different_address"]').is(":checked"))||(i=t.billingAddress||t.shippingAddress)&&!o.isEmptyObject(i)&&this.populate_billing_address(i),this.populate_detail_fields(t),t.shippingAddress&&!o.isEmptyObject(t.shippingAddress)&&this.populate_shipping_address(t.shippingAddress)},wc_braintree.PayPal.prototype.get_address_mappings=function(){return["recipientName","line1","line2","city","countryCode","postalCode","state","phone"]},wc_braintree.PayPal.prototype.populate_detail_fields=function(e){[["first_name","firstName"],["last_name","lastName"],["email","email"],["phone","phone"]].forEach(function(t){("checkout"!==this.get_page()||e[t[1]]&&this.fields.isEmpty("billing_"+t[0]))&&this.fields.set(t[0],e[t[1]],"billing")}.bind(this)),e.phone&&this.fields.exists("shipping_phone")&&this.fields.isEmpty("shipping_phone")&&this.fields.set("shipping_phone",e.phone)},wc_braintree.PayPal.prototype.open_shipping_modal=function(t,n){function a(t){t.preventDefault(),o(".wc-braintree-shipping-modal-overlay").remove(),o(".wc-braintree-shipping-modal").remove(),o("body").removeClass("shipping-modal-active")}function s(){o("#preloaderSpinner").hide()}this.block(),o.ajax({method:"POST",dataType:"json",url:this.params.routes.paypal_shipping,data:t,success:function(t){this.unblock(),function(t){var e=o("<div>",{"class":"wc-braintree-shipping-modal-overlay"}),i=o("<div>",{"class":"wc-braintree-shipping-modal"});i.append(t).show(),o("body").addClass("shipping-modal-active").append(e).append(i),o(".wc-braintree-shipping-modal").on("click",'[name^="wc_shipping_method"]',function(t){!function(){o("#preloaderSpinner").height(o(".paypal-shipping-methods").outerHeight()+20).show();var t=o(".wc-braintree-shipping-modal").height(),e=o(".wc-braintree-shipping-modal").scrollTop(),t=t/2+e;o(".spinWrap").css("top",t)}();t=o(t.target).data("index")+":"+o(t.target).val();this.update_shipping_method(t).then(function(t){s(),o(".cart-totals").replaceWith(t.data.cart_totals),n.onShippingMethodSelected&&n.onShippingMethodSelected.call(this,t.data)}.bind(this))["catch"](function(){s()}.bind(this))}.bind(this)),o(".wc-braintree-shipping-modal").on("click","#place_order",function(t){a(t),this.process_checkout()}.bind(this)),o(".wc-braintree-shipping-modal").on("click","#close",a)}.call(this,t.html)}.bind(this),error:function(){this.unblock()}.bind(this)})},wc_braintree.PayPal.prototype.map_shipping_address=function(t){return{address_1:t.line1,address_2:t.line2,city:t.city,postcode:t.postalCode,state:t.state,country:t.countryCode}},wc_braintree.PayPal.prototype.is_checkout_flow=function(){return"checkout"===this.params.options.flow},wc_braintree.GooglePay=function(){wc_braintree.BaseGateway.call(this),this.create_payments_client(),this.create_button()},wc_braintree.GooglePay.prototype=Object.create(wc_braintree.BaseGateway.prototype),wc_braintree.GooglePay.prototype.get_environment=function(){return this.params.google_environment},wc_braintree.GooglePay.prototype.get_merchant_id=function(){return this.params.google_merchant},wc_braintree.GooglePay.prototype.get_merchant_info=function(){var t={merchantName:this.params.google_merchant_name,merchantId:this.get_merchant_id()};return t.merchantId||delete t.merchantId,t},wc_braintree.GooglePay.prototype.after_payment_data_callback=function(){},wc_braintree.GooglePay.prototype.create_payments_client=function(){var t,e={environment:this.get_environment(),merchantInfo:this.get_merchant_info()};e.paymentDataCallbacks={onPaymentAuthorized:function(t){return new Promise(function(t,e){t({transactionState:"SUCCESS"})}.bind(this))}.bind(this)},this.needs_shipping()&&(t=this.get_shipping_prefix(),this.is_checkout_page()&&this.is_valid_address(this.get_address_object(t),t,["phoneNumber"])||(e.paymentDataCallbacks.onPaymentDataChanged=function(i){return new Promise(function(e,t){this.payment_data_callback(i).then(function(t){e(t.requestUpdate),this.after_payment_data_callback(t)}.bind(this))["catch"](function(t){e(t)}.bind(this))}.bind(this))}.bind(this))),this.paymentsClient=new google.payments.api.PaymentsClient(e)},wc_braintree.GooglePay.prototype.create_instance=function(t,e){return new Promise(function(i,n){this.clientInstance=t,this.config=t.getConfiguration().gatewayConfiguration,this.initialize_3d_secure(),braintree.googlePayment.create({client:t,googlePayVersion:2,googleMerchantId:this.get_merchant_id()},function(t,e){t?this.submit_error(t):(this.googlePayInstance=e,this.initialize_fraud_tools(),this.paymentsClient.isReadyToPay({apiVersion:2,apiVersionMinor:0,allowedPaymentMethods:e.createPaymentDataRequest().allowedPaymentMethods}).then(function(t){(t.result?(this.cannot_pay=!1,i):(this.cannot_pay=!0,n))(t)}.bind(this))["catch"](function(t){this.submit_error({message:t.statusMessage})}.bind(this)))}.bind(this))}.bind(this))},wc_braintree.GooglePay.prototype.create_button=function(){return new Promise(function(t,e){this.$button&&this.$button.remove(),this.paymentsClient&&(this.$button=o(this.paymentsClient.createButton(o.extend({onClick:this.tokenize.bind(this)},this.params.button_options))),this.is_rectangle_button()?this.$button.find("button").removeClass("new_style"):this.$button.find("button").addClass("gpay-button-round"),t())}.bind(this))},wc_braintree.GooglePay.prototype.is_rectangle_button=function(){return"rect"===this.params.button_shape},wc_braintree.GooglePay.prototype.tokenize=function(){this.create_payments_client();var t=this.googlePayInstance.createPaymentDataRequest(this.get_payment_data_request()),e=t.allowedPaymentMethods[0];e.parameters.assuranceDetailsRequired=!0,e.parameters.billingAddressRequired=!0,e.parameters.billingAddressParameters={format:"FULL",phoneNumberRequired:this.fields.requestFieldInWallet("billing_phone")},this.billing_checkout_address=this.get_address_object("billing");try{this.paymentsClient.loadPaymentData(t).then(function(t){return this.paymentData=t,this.update_addresses(t),this.googlePayInstance.parseResponse(t)}.bind(this)).then(function(t){this.set_tokeninzed_response(JSON.stringify(t)),this.set_nonce(t.nonce),this.set_device_data(),this.params._3ds.enabled&&!1===t.details.isNetworkTokenized&&"threeDSecureEnabled"in this.config&&this.config.threeDSecureEnabled?wc_braintree.CreditCard.prototype.process_3dsecure.call(this,t):this.on_payment_method_received(t)}.bind(this))["catch"](function(t){"CANCELED"!==t.statusCode&&(t={code:-1<t.statusMessage.indexOf("whitelisted")?"DEVELOPER_ERROR_WHITELIST":null,message:t.statusMessage},this.submit_error(t))}.bind(this))}catch(i){this.submit_error({message:i})}},wc_braintree.GooglePay.prototype.get_payment_data_request=function(){var t,e={merchantInfo:this.get_merchant_info(),transactionInfo:{countryCode:this.params.country_code,currencyCode:this.get_currency(),totalPriceStatus:"FINAL",totalPrice:this.get_total().toString(),totalPriceLabel:this.get_price_label(),displayItems:this.get_items()},emailRequired:this.fields.requestFieldInWallet("billing_email")};return!this.needs_shipping()||(t=this.get_shipping_prefix(),this.is_checkout_page()&&this.is_valid_address(this.get_address_object(t),t,["phoneNumber"]))?e.callbackIntents=["PAYMENT_AUTHORIZATION"]:(e.shippingAddressParameters={},e.shippingAddressRequired=!0,e.callbackIntents=["PAYMENT_AUTHORIZATION","SHIPPING_ADDRESS","SHIPPING_OPTION"],e.shippingOptionRequired=!0,(t=this.get_shipping_options())&&0<t.length&&(e.shippingOptionParameters={shippingOptions:t,defaultSelectedOptionId:t[0].id})),this.payment_request_options=e},wc_braintree.GooglePay.prototype.update_addresses=function(t){var e;t.paymentMethodData.info.billingAddress&&(e=t.paymentMethodData.info.billingAddress,this.is_checkout_page()?this.is_valid_address(this.billing_checkout_address,"billing",["phoneNumber"])&&e.phoneNumber?(e={phoneNumber:e.phoneNumber},this.populate_billing_address(e)):this.is_valid_address(this.billing_checkout_address,"billing",["phoneNumber"])||this.populate_billing_address(e):this.populate_billing_address(e)),t.shippingAddress&&this.populate_shipping_address(t.shippingAddress),t.email&&this.fields.set("email",t.email,"billing")},wc_braintree.GooglePay.prototype.payment_data_callback=function(n){return new Promise(function(e,i){var t="shipping_option_unselected"===n.shippingOptionData.id?null:n.shippingOptionData.id;"SHIPPING_ADDRESS"===n.callbackTrigger&&(t=null),this.update_shipping({country:n.shippingAddress.countryCode,state:n.shippingAddress.administrativeArea,city:n.shippingAddress.locality,postcode:n.shippingAddress.postalCode},t).then(function(t){e(t.data[this.gateway_id])}.bind(this))["catch"](function(t){i(t.data[this.gateway_id])}.bind(this))}.bind(this))},wc_braintree.GooglePay.prototype.get_address_mappings=function(){return["name","postalCode","countryCode","phoneNumber","address1","address2","locality","administrativeArea"]},wc_braintree.GooglePay.prototype.block=function(){o().block&&o.blockUI({message:null,overlayCSS:{background:"#fff",opacity:.6}})},wc_braintree.GooglePay.prototype.unblock=function(){o().block&&o.unblockUI()},wc_braintree.GooglePay.prototype.clear_error=function(){this.paymentData=null,o("#wc_braintree_checkout_error").remove()},wc_braintree.CreditCard=function(){wc_braintree.BaseGateway.call(this),this._3ds_vaulted_nonce_selector='[name="'+this.params._3ds_vaulted_nonce_selector+'"]',this.config_selector='[name="'+this.params.config_selector+'"]'},wc_braintree.CreditCard.prototype=Object.create(wc_braintree.BaseGateway.prototype),wc_braintree.CreditCard.prototype.create_instance=function(t,e){this.clientInstance=t,this.client_token=e,this.config=t.getConfiguration().gatewayConfiguration,this.initialize_fraud_tools(),this.initialize_3d_secure()},wc_braintree.CreditCard.prototype.set_config_data=function(){o(this.config_selector).val(JSON.stringify(this.config))},wc_braintree.CreditCard.prototype.get_hosted_fields=function(){this.hosted_fields={};var n=this;return o.each(this.params.custom_fields,function(t,e){o("#"+e.id).length&&e.type&&(n.hosted_fields[e.type]={selector:"#"+e.id,placeholder:e.placeholder})}),o.each(this.hosted_fields,function(t,e){var i=!1;switch(t){case"cvv":-1===n.config.challenges.indexOf("cvv")&&(i=!0);break;case"postalCode":(o("#wc-braintree-postal-code").length||!o("#billing_postcode").length)&&(-1!==n.config.challenges.indexOf("postal_code")||o("#billing_postcode").length)||(i=!0)}i&&(o(e.selector).closest("."+t+"-container").remove(),o(document.body).triggerHandler("wc_braintree_hosted_field_removed",t),delete n.hosted_fields[t])}),this.sorted_fields=[],o(".wc-braintree-cc-container").find('[id^="wc-braintree-"]').each(function(t,e){this.sorted_fields.push("#"+o(e).attr("id"))}.bind(this)),this.hosted_fields},wc_braintree.CreditCard.prototype._3ds_enabled=function(){return this.get_gateway_data()._3ds.enabled&&this.config.threeDSecureEnabled},wc_braintree.CreditCard.prototype._3ds_active=function(){return this.get_gateway_data()._3ds.active&&this.config.threeDSecureEnabled},wc_braintree.CreditCard.prototype.payment_nonce_request=function(t){return o.ajax({type:"POST",url:this.params.urls._3ds.vaulted_nonce,data:{_wpnonce:this.params._wp_rest_nonce,token:t,version:2}})},wc_braintree.CreditCard.prototype.get_tokenization_options=function(){var t={billingAddress:{}};return this.fields.exists("billing_address_1")&&(t.billingAddress.streetAddress=this.fields.get("billing_address_1")),this.fields.exists("billing_postcode")&&(t.billingAddress.postalCode=this.fields.get("billing_postcode")),t},wc_braintree.CreditCard.prototype.teardown_3ds=function(){this.threeDSecureInstance.teardown().then(this.initialize_3d_secure.bind(this))["catch"](this.initialize_3d_secure.bind(this))},wc_braintree.CreditCard.prototype.get_3ds_amount=function(){return this.is_checkout_page()?this.get_order_total():"add_payment_method"===this.get_page()?"0.00":this.get_total()},wc_braintree.CreditCard.prototype.process_3dsecure=function(t,i){var e;this.threeDSecureInstance&&(e=this.get_shipping_prefix(),this.threeDSecureInstance.verifyCard({amount:this.get_3ds_amount(),nonce:t.nonce,bin:t.details.bin,email:this.fields.get("billing_email",""),challengeRequested:this.params._3ds.challengeRequested,billingAddress:{givenName:this.fields.get("billing_first_name","").replace(/[^\x00-\x7f]/g,""),surname:this.fields.get("billing_last_name","").replace(/[^\x00-\x7f]/g,""),phoneNumber:this.fields.get("billing_phone",""),streetAddress:this.fields.get("billing_address_1","").slice(0,50),extendedAddress:this.fields.get("billing_address_2","").slice(0,50),locality:this.fields.get("billing_city","").slice(0,50),region:!this.fields.required("billing_state")||3<this.fields.get("billing_state","").length?"":this.fields.get("billing_state",""),postalCode:this.fields.get("billing_postcode",""),countryCodeAlpha2:this.fields.get("billing_country","")},additionalInformation:this.needs_shipping()?{shippingGivenName:this.fields.get(e+"_first_name","").replace(/[^\x00-\x7f]/g,""),shippingSurname:this.fields.get(e+"_last_name","").replace(/[^\x00-\x7f]/g,""),shippingAddress:{streetAddress:this.fields.get(e+"_address_1","").slice(0,50),extendedAddress:this.fields.get(e+"_address_2","").slice(0,50),locality:this.fields.get(e+"_city","").slice(0,50),region:!this.fields.required(e+"_state")||3<this.fields.get(e+"_state","").length?"":this.fields.get(e+"_state",""),postalCode:this.fields.get(e+"_postcode",""),countryCodeAlpha2:this.fields.get(e+"_country","")}}:{},onLookupComplete:function(t,e){"remove_loader"in this&&this.remove_loader(),e()}.bind(this)},function(t,e){if(this.enable_place_order(),t)this.submit_error(t),this.remove_loader();else{if(e.threeDSecureInfo&&"challenge_required"===e.threeDSecureInfo.status)return this.teardown_3ds();i&&o(this._3ds_vaulted_nonce_selector).val("true"),this.is_checkout_page()||this.set_nonce(e.nonce),this.on_payment_method_received(e)}}.bind(this)),i&&this.unblock_form())},wc_braintree.CreditCard.prototype.process_3dsecure_vaulted=function(){this.block_form(),o.when(this.payment_nonce_request(this.get_payment_token())).done(function(t){t.success?this.process_3dsecure(t.data,!0):(this.submit_error(t.message),this.unblock_form())}.bind(this)).fail(function(t,e,i){this.submit_error({message:i}),this.unblock_form()}.bind(this))},wc_braintree.CreditCard.prototype.add_icon_class=function(t,e,i){o(i).addClass(this.params.icon_style)},wc_braintree.CreditCard.prototype.add_icon_type=function(){o(this.container).find(".wc-braintree-payment-methods-container").addClass(this.params.icon_style+"-icons")},wc_braintree.CreditCard.prototype.block_form=function(){o(this.container).closest("form").block(wc_braintree.blockUI)},wc_braintree.CreditCard.prototype.unblock_form=function(){o(this.container).closest("form").unblock()},wc_braintree.CreditCard.prototype.display_loader=function(){this.params.loader.enabled&&o(".wc-braintree-payment-loader").fadeIn(200)},wc_braintree.CreditCard.prototype.remove_loader=function(){o(".wc-braintree-payment-loader").fadeOut(200)},wc_braintree.CreditCard.prototype.submit_card_error=function(t){return wc_braintree.BaseGateway.prototype.submit_error.call(this,t,!0)},wc_braintree.CreditCard.prototype.handle_create_account_change=function(){o("#createaccount").length&&(o("#createaccount").is(":checked")?(o(".wc-braintree-save-card-container").length?o(".wc-braintree-save-card-container"):o("#braintree_cc_save_method").parent()).show():(o(".wc-braintree-save-card-container").length?o(".wc-braintree-save-card-container"):o("#braintree_cc_save_method").parent()).hide())},wc_braintree.ApplePay=function(){wc_braintree.BaseGateway.call(this)},wc_braintree.ApplePay.prototype=Object.create(wc_braintree.BaseGateway.prototype),wc_braintree.ApplePay.prototype.create_instance=function(t,e){return this.clientInstance=t,this.initialize_fraud_tools(),new Promise(function(i,n){this.can_initialize_applepay()?braintree.applePay.create({client:this.clientInstance},function(t,e){t?(n(),this.submit_error(t)):(this.applePayInstance=e,i())}.bind(this)):n()}.bind(this))},wc_braintree.ApplePay.prototype.open_wallet=function(){this.applePaySession.begin()},wc_braintree.ApplePay.prototype.init_wallet=function(){this.paymentRequest=this.applePayInstance.createPaymentRequest(this.get_payment_request());try{var t=new ApplePaySession(this.get_applepay_version(),this.paymentRequest);(this.applePaySession=t).onvalidatemerchant=this.onvalidatemerchant.bind(this),this.needs_shipping()||"order_pay"===this.get_page()||(t.onpaymentmethodselected=this.onpaymentmethodselected.bind(this)),this.needs_shipping()&&(-1<this.paymentRequest.requiredShippingContactFields.indexOf("postalAddress")?(t.onshippingcontactselected=this.onshippingcontactselected.bind(this),t.onshippingmethodselected=this.onshippingmethodselected.bind(this)):this.can_ship=!0),t.onpaymentauthorized=this.onpaymentauthorized.bind(this)}catch(e){this.submit_error(e)}},wc_braintree.ApplePay.prototype.get_applepay_version=function(){return ApplePaySession.supportsVersion(4)?4:ApplePaySession.supportsVersion(3)?3:void 0},wc_braintree.ApplePay.prototype.get_payment_request=function(){var t={total:{label:this.params.store_name,amount:this.get_total(),type:"final"},lineItems:this.get_items(),currencyCode:this.get_currency(),requiredBillingContactFields:this.get_billing_fields_array(),requiredShippingContactFields:this.get_shipping_fields_array()};return this.needs_shipping()&&-1<t.requiredShippingContactFields.indexOf("postalAddress")&&(t.shippingMethods=this.get_shipping_options()),t},wc_braintree.ApplePay.prototype.get_address_mappings=function(){return["givenName","familyName","addressLines","administrativeArea","locality","postalCode","phoneNumber","emailAddress","countryCode"]},wc_braintree.ApplePay.prototype.populate_address_fields=function(t,e){for(var i in t)"shipping"===e&&-1<["phoneNumber","emailAddress"].indexOf(i)&&this.fields.set(i,t[i],"billing"),this.fields.set(i,t[i],e)},wc_braintree.ApplePay.prototype.get_contact_field_from_key=function(t){return t=-1<["givenName","familyName"].indexOf(t)?"name":t},wc_braintree.ApplePay.prototype.validate_response=function(t){var e,i,n,a,s=[],r=this.params.messages.errors,o=this.get_address_mappings();if(t.shippingContact){var c=this.needs_shipping()?t.shippingContact:(i=t.shippingContact,n={},["emailAddress","phoneNumber"].forEach(function(t){"undefined"!=typeof i[t]&&(n[t]=i[t])}),n);for(e in c)-1<o.indexOf(e)&&""!==c[e]&&(this.fields.isValid(e,c[e],c)||s.push(new ApplePayError("shippingContactInvalid",this.get_contact_field_from_key(e))))}if(t.billingContact)for(e in t.billingContact)-1<o.indexOf(e)&&""!==t.billingContact[e]&&(this.fields.isValid(e,t.billingContact[e],t.billingContact)||(a="undefined"!=typeof r[a="invalid_"+this.get_contact_field_from_key(e)]?r[a]:"",s.push(new ApplePayError("billingContactInvalid",this.get_contact_field_from_key(e),a))));return s},wc_braintree.ApplePay.prototype.get_billing_fields_array=function(){return this.is_checkout_page()&&this.is_valid_address(this.get_address_object("billing"),"billing",["phoneNumber","emailAddress"])?[]:["postalAddress"]},wc_braintree.ApplePay.prototype.get_shipping_fields_array=function(){var t,e=[];return!this.needs_shipping()||this.is_checkout_page()&&(t=this.get_address_object(this.get_shipping_prefix()),this.is_valid_address(t,this.get_shipping_prefix(),["phoneNumber","emailAddress"]))||e.push("postalAddress"),this.fields.requestFieldInWallet("billing_email")&&e.push("email"),this.fields.requestFieldInWallet("billing_phone")&&e.push("phone"),e},wc_braintree.ApplePay.prototype.populate_address_data=function(i){return new Promise(function(t,e){"undefined"!=typeof i.shippingContact&&this.populate_address_fields(i.shippingContact,"shipping"),"undefined"!=typeof i.billingContact&&this.populate_address_fields(i.billingContact,"billing"),t(i)}.bind(this))},wc_braintree.ApplePay.prototype.can_initialize_applepay=function(){return window.ApplePaySession&&ApplePaySession.canMakePayments()},wc_braintree.ApplePay.prototype.has_nonce=function(){return 0<o(this.nonce_selector).val().length},wc_braintree.ApplePay.prototype.onvalidatemerchant=function(t){this.applePayInstance.performValidation({validationURL:t.validationURL,displayName:this.params.store_name},function(t,e){t?(this.submit_error(t),this.applePaySession.abort()):this.applePaySession.completeMerchantValidation(e)}.bind(this))},wc_braintree.ApplePay.prototype.onshippingcontactselected=function(t){this.update_shipping_address({country:t.shippingContact.countryCode.toUpperCase(),state:t.shippingContact.administrativeArea.toUpperCase(),postcode:t.shippingContact.postalCode,city:t.shippingContact.locality}).then(function(t){this.can_ship=!0,this.applePaySession.completeShippingContactSelection(t.data.shippingContactUpdate),this.fields.set("shipping_method",t.data.chosen_shipping_methods)}.bind(this))["catch"](function(t){"addressUnserviceable"===t.code?(this.can_ship=!1,this.applePaySession.completeShippingContactSelection(t.data.shippingContactUpdate)):this.applePaySession.completeShippingContactSelection({errors:[new ApplePayError(t.code,t.data.contactField,t.message)],newTotal:t.data.newTotal,newShippingMethods:t.data.newShippingMethods})}.bind(this))},wc_braintree.ApplePay.prototype.onshippingmethodselected=function(t){t=t.shippingMethod.identifier;this.update_shipping_method(t).then(function(t){t.code?(this.applePaySession.abort(),this.submit_error(t.messages)):this.applePaySession.completeShippingMethodSelection(t.data.shippingMethodUpdate)}.bind(this))["catch"](function(t){this.applePaySession.abort(),this.submit_error(t)}.bind(this))},wc_braintree.ApplePay.prototype.onpaymentmethodselected=function(t){o.ajax({url:this.params.routes.applepay_payment_method,method:"POST",dataType:"json",data:{wc_braintree_currency:this.get_currency()},beforeSend:this.ajax_before_send.bind(this),success:function(t,e,i){t.success?this.applePaySession.completePaymentMethodSelection(t.data):(this.applePaySession.abort(),this.submit_error(t.messages))}.bind(this),error:function(t,e,i){this.applePaySession.abort(),this.submit_error(i)}.bind(this)})},wc_braintree.ApplePay.prototype.onpaymentauthorized=function(a){return new Promise(function(i,n){this.applePayInstance.tokenize({token:a.payment.token},function(t,e){t?(this.submit_error(t),this.applePaySession.completePayment(ApplePaySession.STATUS_FAILURE)):(0<(t=this.validate_response(a.payment)).length?(this.applePaySession.completePayment({status:ApplePaySession.STATUS_FAILURE,errors:t}),n):this.needs_shipping()&&!this.can_ship?(this.applePaySession.completePayment({status:ApplePaySession.STATUS_FAILURE,errors:[new ApplePayError("addressUnserviceable")]}),n):(this.applePaySession.completePayment(ApplePaySession.STATUS_SUCCESS),this.set_nonce(e.nonce),this.set_device_data(),this.populate_address_data(a.payment),this.set_payment_method(this.gateway_id),this.on_payment_method_received(e),i))(e)}.bind(this))}.bind(this))},t.prototype.onChange=function(t){try{var e=t.currentTarget.name,i=t.currentTarget.value;this.fields.set(e,i),"billing_country"!==e&&"shipping_country"!==e||this.update_required_fields(i,e)}catch(n){console.log(n)}},t.prototype.init_i18n=function(){"undefined"!=typeof wc_address_i18n_params?this.locales=JSON.parse(wc_address_i18n_params.locale.replace(/&quot;/g,'"')):this.locales=null},t.prototype.set=function(t,e,i){this[t]&&"function"==typeof this[t]?this[t]().set.call(this,e,i):this.fields.set(t,e)},t.prototype.get=function(t,e){var i;return this[t]&&"function"==typeof this[t]?i=this[t]().get.call(this,e):null!=(i=this.fields.get(t))&&""!==i||void 0!==e&&(i=e),null==i?"":i},t.prototype.exists=function(t){return"undefined"!=typeof this.params[t]},t.prototype.required=function(t){return!(!this.params[t]||"undefined"==typeof this.params[t].required)&&this.params[t].required},t.prototype.isValid=function(t){if(this[t]&&"function"==typeof this[t])return this[t]().isValid.apply(this,Array.prototype.slice.call(arguments,1))},t.prototype.isEmpty=function(t){return!this.fields.has(t)||(null==(t=this.fields.get(t))||"string"==typeof t&&0===t.trim().length)},t.prototype.requestFieldInWallet=function(t){return"checkout"===this.page?this.required(t)&&this.isEmpty(t):"order_pay"!==this.page&&this.required(t)},t.prototype.update_required_fields=function(t,e){if(this.locales){var i,n=-1<e.indexOf("billing_")?"billing_":"shipping_",e="undefined"!=typeof this.locales[t]?this.locales[t]:this.locales["default"],a=o.extend(!0,{},this.locales["default"],e);for(i in a){var s=n+i;this.params[s]&&(this.params[s]=o.extend(!0,{},this.params[s],a[i]))}}},t.prototype.on_ship_to_address_change=function(t){o(t.currentTarget).is(":checked")&&this.update_required_fields(o("#shipping_country").val(),"shipping_country")},t.prototype.first_name=function(){return{set:function(t,e){this.fields.set(e+"_first_name",t)},get:function(t){return this.fields.get(t+"_first_name")},required:function(t){return this.required(t+"_first_name")},isValid:function(t){return void 0!==t&&""!==t}}},t.prototype.last_name=function(){return{set:function(t,e){this.fields.set(e+"_last_name",t)},get:function(t){return this.fields.get(t+"_last_name")},required:function(t){return this.required(t+"_last_name")},isValid:function(t){return void 0!==t&&""!==t}}},t.prototype.name=function(){return{set:function(t,e){this.fields.set(e+"_full_name",t);t=t.split(" ");1<t.length?(this.fields.set(e+"_last_name",t.pop()),this.fields.set(e+"_first_name",t.join(" "))):1==t.length&&this.fields.set(e+"_first_name",t[0])},get:function(t){t=this.fields.get(t+"_first_name")+" "+this.fields.get(t+"_last_name");return t="string"==typeof t&&t.match(/^\s+$/)?"":t},required:function(t){return this.required(t+"_first_name")&&this.required(t+"_last_name")},isValid:function(t){return void 0!==t&&""!==t}}},t.prototype.country=function(){return{set:function(t,e){this.fields.set(e+"_country",t.toUpperCase())},get:function(t){return this.fields.get(t+"_country")},required:function(t){return this.required(t+"_country")},isValid:function(t){return"string"==typeof t&&2===t.length}}},t.prototype.address_1=function(){return{set:function(t,e){this.fields.set(e+"_address_1",t)},get:function(t){return this.fields.get(t+"_address_1")},required:function(t){return this.required(t+"_address_1")},isValid:function(t){return void 0!==t&&""!==t&&null!==t}}},t.prototype.address_2=function(){return{set:function(t,e){this.fields.set(e+"_address_2",t)},get:function(t){return this.fields.get(t+"_address_2")},required:function(t){return this.required(t+"_address_2")},isValid:function(t){return void 0!==t&&""!==t&&null!==t}}},t.prototype.city=function(){return{set:function(t,e){this.fields.set(e+"_city",t)},get:function(t){return this.fields.get(t+"_city")},required:function(t){return this.required(t+"_city")},isValid:function(t){return void 0!==t&&""!==t&&null!==t}}},t.prototype.state=function(){return{set:function(i,t){2<(i=i.toUpperCase()).length&&"checkout"===this.page&&o("#"+t+"_state option").each(function(){var t=o(this),e=t.text().toUpperCase();i===e&&(i=t.val())}),this.fields.set(t+"_state",i)},get:function(t){return this.fields.get(t+"_state")},required:function(t){return this.required(t+"_state")},isValid:function(t){return void 0!==t&&""!==t&&null!==t}}},t.prototype.postcode=function(){return{set:function(t,e){this.fields.set(e+"_postcode",t)},get:function(t){return this.fields.get(t+"_postcode")},required:function(t){return this.required(t+"_postcode")},isValid:function(t){return void 0!==t&&""!==t&&null!==t}}},t.prototype.phone=function(){return{set:function(t,e){this.fields.set(e+"_phone",t)},get:function(t){return this.fields.has(t+"_phone")?this.fields.get(t+"_phone"):this.fields.get("billing_phone")},required:function(t){return this.required(t+"_phone")},isValid:function(t){return void 0!==t&&""!==t&&null!==t}}},t.prototype.email=function(){return{set:function(t,e){this.fields.set(e+"_email",t)},get:function(t){return this.fields.get(t+"_email")},required:function(t){return this.required(t+"_email")},isValid:function(t){return void 0!==t&&""!==t&&null!==t}}},t.prototype.recipientName=function(){return this.name.apply(this,arguments)},t.prototype.line1=function(){return this.address_1.apply(this,arguments)},t.prototype.line2=function(){return this.address_2.apply(this,arguments)},t.prototype.countryCode=function(){return this.country.apply(this,arguments)},t.prototype.postalCode=function(){return this.postcode.apply(this,arguments)},t.prototype.phoneNumber=function(){return this.phone.apply(this,arguments)},t.prototype.address1=function(){return this.address_1.apply(this,arguments)},t.prototype.address2=function(){return this.address_2.apply(this,arguments)},t.prototype.locality=function(){return this.city.apply(this,arguments)},t.prototype.administrativeArea=function(){return this.state.apply(this,arguments)},t.prototype.givenName=function(){return this.first_name.apply(this,arguments)},t.prototype.familyName=function(){return this.last_name.apply(this,arguments)},t.prototype.addressLines=function(){return{set:function(t,e){this.address_1().set.call(this,t[0],e),1<t.length&&this.address_2().set.call(this,t[1],e)},get:function(t){var e=[];return e.push(this.fields.get(t+"_address_1")),this.fields.get(t+"_address_2")&&e.push(this.fields.get(t+"_address_2")),e},required:function(t){return this.required(t+"_address_1")},isValid:function(t){return 0<t.length&&("undefined"!=typeof t[0]&&null!==t[0]&&""!==t[0].trim())}}},t.prototype.emailAddress=function(){return this.email.apply(this,arguments)},t.prototype.toJson=function(){var i={};return this.fields.forEach(function(t,e){i[e]=t}),i},t.prototype.fromFormToFields=function(){this.fields.forEach(function(t,e){var i='[name="'+e+'"]',n=o(i).val();o(i).length&&""!==n&&t!==n&&this.fields.set(e,n)}.bind(this))},t.prototype.toFormFields=function(t){var i=[];this.fields.forEach(function(t,e){e='[name="'+e+'"]';o(e).length&&""!==t&&(o(e).val()!==t&&o(e).is("select")&&i.push(e),o(e).val(t))}),0<i.length&&o(i.join(",")).trigger("change"),void 0!==t&&o(document.body).trigger("update_checkout",t)},t.prototype.validateFields=function(t){for(var e in this.params){var i=this.params[e];if(-1<e.indexOf(t)&&i.required&&o("#"+e).length&&o("#"+e).is(":visible")){i=o("#"+e).val();if(null==i||0===i.length)return!1}}return!0};var e=new t(wc_braintree_checkout_fields,wc_braintree_global_params.page)}(jQuery);